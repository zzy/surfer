(self.webpackChunkstacksEditor=self.webpackChunkstacksEditor||[]).push([[662],{2662:(t,e,n)=>{"use strict";n.r(e),n.d(e,{EditorType:()=>jn,StacksEditor:()=>Bn});var r=n(2778),o=n(6189),i=n(4751),a=n(6922),s=n(8780),l=n(4943),c={bsh:"bash",csh:"bash",sh:"bash",c:"cpp",cc:"cpp",cxx:"cpp",cyc:"cpp",m:"cpp",cs:"csharp",coffee:"coffeescript",html:"xml",xsl:"xml",js:"javascript",pl:"perl",py:"python",cv:"python",rb:"ruby",clj:"clojure",erl:"erlang",hs:"haskell",mma:"mathematica",tex:"latex",cl:"lisp",el:"lisp",lsp:"lisp",scm:"scheme",ss:"scheme",rkt:"scheme",fs:"ocaml",ml:"ocaml",s:"r",rc:"rust",rs:"rust",vhd:"vhdl",none:"plaintext"};function u(t,e){return void 0===e&&(e="none"),n=(t.attrs.params||"").split(/\s/)[0].toLowerCase()||e||null,c[n]||n;var n}function d(t){var e=function(){var t=n.g.hljs;if(!t)try{t=n(7869)}catch(t){}return t&&t.highlight?t:null}();return e?(0,l.highlightPlugin)(e,["code_block"],(function(e){return e.attrs.detectedHighlightLanguage||u(e,t)})):new a.Plugin({})}var p=function(t,e){for(var n=0,r=e.length,o=t.length;n<r;n++,o++)t[o]=e[n];return t};function f(t,e){return void 0===e&&(e=""),t?["%c"+e+t,"font-weight: bold;"]:[]}function h(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n]}function m(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];console.error.apply(console,p(p([],f(t)),e))}var g,v=n(7022),b=n(8202),k=n(8638),y=(g=function(t,e){return(g=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}g(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),w=function(){return(w=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},_=b.fK,C=_.spec.nodes,S=w(w({},C.get("image")),{attrs:{src:{},alt:{default:null},title:{default:null},width:{default:null},height:{default:null}},parseDOM:[{tag:"img[src]",getAttrs:function(t){return{src:t.getAttribute("src"),title:t.getAttribute("title"),alt:t.getAttribute("alt"),height:t.getAttribute("height"),width:t.getAttribute("width")}}}],toDOM:function(t){return["img",t.attrs]}}),x=w(w({},C.get("code_block")),{attrs:{params:{default:""},detectedHighlightLanguage:{default:""}}}),E=C.addBefore("image","pre",("pre",{content:"block+",marks:"",group:"block",inline:!1,selectable:!0,toDOM:function(){return["pre",0]},parseDOM:[{tag:"pre"}]})).addBefore("image","html_block",{content:"text*",attrs:{content:{default:""}},marks:"_",group:"block",atom:!0,inline:!1,selectable:!0,defining:!0,isolating:!0,parseDOM:[{tag:"div.html_block"}],toDOM:function(t){return["div",{class:"html_block"},t.attrs.content]}}).addBefore("image","html_inline",{content:"text*",attrs:{content:{default:""}},marks:"_",group:"inline",atom:!0,inline:!0,selectable:!0,defining:!0,isolating:!0,parseDOM:[{tag:"span.html_inline"}],toDOM:function(t){return["span",{class:"html_inline"},t.attrs.content]}}).addBefore("image","html_block_container",{content:"block*",attrs:{contentOpen:{default:""},contentClose:{default:""}},marks:"_",group:"block",inline:!1,selectable:!0,defining:!0,isolating:!0}).addBefore("image","softbreak",{content:"inline+",attrs:{},marks:"_",inline:!0,group:"inline",parseDOM:[{tag:"span[softbreak]",getAttrs:function(t){return{content:t.innerHTML}}}],toDOM:function(){return["span",{softbreak:""},0]}}).addBefore("image","table",{content:"table_head table_body*",isolating:!0,group:"block",selectable:!1,parseDOM:[{tag:"table"}],toDOM:function(){return["div",{class:"s-table-container"},["table",{class:"s-table"},0]]}}).addBefore("image","table_head",{content:"table_row",isolating:!0,group:"table_block",selectable:!1,parseDOM:[{tag:"thead"}],toDOM:function(){return["thead",0]}}).addBefore("image","table_body",{content:"table_row+",isolating:!0,group:"table_block",selectable:!1,parseDOM:[{tag:"tbody"}],toDOM:function(){return["tbody",0]}}).addBefore("image","table_row",{content:"(table_cell | table_header)+",isolating:!0,group:"table_block",selectable:!1,parseDOM:[{tag:"tr"}],toDOM:function(){return["tr",0]}}).addBefore("image","table_cell",{content:"inline*",isolating:!0,group:"table_block",selectable:!1,attrs:{style:{default:null}},parseDOM:[{tag:"td",getAttrs:function(t){var e=t.style.textAlign;return e?{style:"text-align: "+e}:null}}],toDOM:function(t){return["td",t.attrs,0]}}).addBefore("image","table_header",{content:"inline*",isolating:!0,group:"table_block",selectable:!1,attrs:{style:{default:null}},parseDOM:[{tag:"th",getAttrs:function(t){var e=t.style.textAlign;return e?{style:"text-align: "+e}:null}}],toDOM:function(t){return["th",t.attrs,0]}}).addBefore("image","tagLink",{content:"text*",marks:"",atom:!0,inline:!0,group:"inline",attrs:{tagName:{default:null},tagType:{default:"tag"}}}).addBefore("blockquote","spoiler",{content:"block+",group:"block",attrs:{revealed:{default:!1}},parseDOM:[{tag:"blockquote.spoiler",getAttrs:function(t){return{revealed:t.classList.contains("is-visible")}}}],toDOM:function(t){return["blockquote",{class:"spoiler"+(t.attrs.revealed?" is-visible":"")},0]}}).update("image",S).update("code_block",x);function L(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return{toDOM:function(){return[t[0],0]},parseDOM:t.map((function(t){return{tag:t}}))}}var M=_.spec.marks,O=w(w({},M.get("link")),{toDOM:function(t){return["a",{href:t.attrs.href,title:t.attrs.title}]}}),T=M.addBefore("strong","strike",L("del","s","strike")).addBefore("strong","kbd",L("kbd")).addBefore("strong","sup",L("sup")).addBefore("strong","sub",L("sub")).update("link",O);T.forEach((function(t,e){var n=e.attrs||{};n.markup={default:""},e.attrs=n})),E.forEach((function(t,e){if("text"!==t){var n=e.attrs||{};n.markup={default:""},e.attrs=n}}));var P,j=new k.V_({nodes:E,marks:T}),I=[j.nodes.table,j.nodes.table_head,j.nodes.table_body,j.nodes.table_row,j.nodes.table_cell,j.nodes.table_header],A=new k.V_({nodes:{doc:{content:"code_block+"},text:{group:"inline"},code_block:{content:"text*",group:"block",marks:"",code:!0,defining:!0,isolating:!0,selectable:!1,attrs:{params:{default:"markdown"}},parseDOM:[{tag:"pre",preserveWhitespace:"full"}],toDOM:function(){return["pre",{class:"s-code-block markdown"},["code",0]]}}},marks:{}}),D=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return y(e,t),e.prototype.parseCode=function(e,n){var r="<pre>"+(0,v.escapeHtml)(e)+"</pre>",o=document.createElement("div");return o.innerHTML=r,t.prototype.parse.call(this,o,n)},e.fromSchema=function(t){return t.cached.domParser||(t.cached.domParser=new e(t,e.schemaRules(t)))},e.toString=function(t){return t.textBetween(0,t.content.size,"\n\n")},e}(k.aw),V=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),B=function(t){function e(e){return t.call(this,e)||this}return V(e,t),e.prototype.get=function(e){return t.prototype.get.call(this,e)},e.prototype.setMeta=function(t,e){return t.setMeta(this,e)},e}(a.PluginKey),N=function(t){function e(e){return t.call(this,e)||this}return V(e,t),Object.defineProperty(e.prototype,"transactionKey",{get:function(){return this.spec.key},enumerable:!1,configurable:!0}),e.prototype.getMeta=function(t){return t.getMeta(this.transactionKey)},e}(a.Plugin),z=function(t){function e(e){return t.call(this,e)||this}return V(e,t),e.prototype.setMeta=function(t,e){var n={callbackData:null,state:e};return t.setMeta(this,n)},e.prototype.setCallbackData=function(t,e){var n={callbackData:e,state:null};return t.setMeta(this,n)},e}(B),F=function(){function t(t,e,n){this.callback=n,this.transactionKey=e,this.attachCallback(t,null)}return t.prototype.update=function(t,e){t.state.doc.eq(e.doc)||this.attachCallback(t,e)},t.prototype.destroy=function(){},t.prototype.attachCallback=function(t,e){var n=this,r=this.inProgressPromise=Math.random();this.callback(t,e).then((function(e){if(r===n.inProgressPromise){n.inProgressPromise=null;var o=t.state.tr;n.transactionKey.setCallbackData(o,e),t.updateState(t.state.apply(o))}else h("AsyncViewHandler attachCallback","cancelling promise update due to another callback taking its place")})).catch((function(){n.inProgressPromise=null}))},t}(),H=function(t){function e(e){return e.view=function(t){return new F(t,e.key,e.asyncCallback)},t.call(this,e)||this}return V(e,t),e.prototype.getMeta=function(t){var e=t.getMeta(this.transactionKey);return null==e?void 0:e.state},e.prototype.getCallbackData=function(t){var e=t.getMeta(this.transactionKey);return null==e?void 0:e.callbackData},e}(N);function q(t){return e=this,n=void 0,o=function(){var e,n;return function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,(function(r){switch(r.label){case 0:return(e=new FormData).append("file",t),[4,fetch("/image/upload",{method:"POST",cache:"no-cache",body:e})];case 1:if(!(n=r.sent()).ok)throw Error("Failed to upload image: "+n.status+" - "+n.statusText);return[4,n.json()];case 2:return[2,r.sent().UploadedImage]}}))},new((r=void 0)||(r=Promise))((function(t,i){function a(t){try{l(o.next(t))}catch(t){i(t)}}function s(t){try{l(o.throw(t))}catch(t){i(t)}}function l(e){var n;e.done?t(e.value):(n=e.value,n instanceof r?n:new r((function(t){t(n)}))).then(a,s)}l((o=o.apply(e,n||[])).next())}));var e,n,r,o}!function(t){t[t.Ok=0]="Ok",t[t.FileTooLarge=1]="FileTooLarge",t[t.InvalidFileType=2]="InvalidFileType"}(P||(P={}));var R=function(){function t(t,e,n,r){var o,i,a=this;this.image=null,this.isVisible=!1,this.uploadOptions=e,this.pluginContainer=n,this.addTransactionDispatcher=r,this.uploadContainer=document.createElement("div"),this.uploadContainer.className="mt6 bt bb bc-black-400 d-none js-image-uploader",this.uploadField=document.createElement("input"),this.uploadField.type="file",this.uploadField.className="d-none",this.uploadField.accept="image/*",this.uploadField.multiple=!1,this.uploadField.id="fileUpload",this.uploadContainer.innerHTML='\n            <div class="fs-body2 p12 pb0"><label class="s-link" for="'+this.uploadField.id+'">Browse</label>, drag & drop, or paste an image <span class="fc-light fs-caption">Max size 2 MiB</span></div>\n            '+this.uploadField.outerHTML+'\n\n            <div class="js-image-preview wmx100 pt12 px12 d-none"></div>\n            <aside class="s-notice s-notice__warning d-none m8 js-validation-message" role="status" aria-hidden="true"></aside>\n\n            <div class="grid ai-center p12">\n                <button class="s-btn s-btn__primary ws-nowrap mr8 js-add-image" type="button" disabled>Add image</button>\n                <button class="s-btn ws-nowrap js-cancel-button" type="button">Cancel</button>\n                <div class="ml64 grid fd-column fs-caption fc-black-300 s-anchors s-anchors__muted">\n                    <div>'+((null===(o=this.uploadOptions)||void 0===o?void 0:o.brandingHtml)||"")+"</div>\n                    <div>"+((null===(i=this.uploadOptions)||void 0===i?void 0:i.contentPolicyHtml)||"")+"</div>\n                </div>\n            </div>\n        ",this.uploadField=this.uploadContainer.querySelector("#fileUpload"),this.uploadField.addEventListener("change",(function(){a.handleFileSelection(t)})),n.appendChild(this.uploadContainer),this.uploadContainer.addEventListener("dragenter",this.highlightDropArea.bind(this)),this.uploadContainer.addEventListener("dragover",this.highlightDropArea.bind(this)),this.uploadContainer.addEventListener("drop",(function(e){a.unhighlightDropArea(e),a.handleDrop(e,t)})),this.uploadContainer.addEventListener("paste",(function(e){a.handlePaste(e,t)})),this.uploadContainer.addEventListener("dragleave",this.unhighlightDropArea.bind(this)),t.dom.parentNode.addEventListener("keydown",(function(e){"Escape"===e.key&&$(t)})),this.uploadContainer.querySelector(".js-cancel-button").addEventListener("click",(function(){return $(t)})),this.uploadContainer.querySelector(".js-add-image").addEventListener("click",(function(e){return a.handleUploadTrigger(e,a.image,t)}))}return t.prototype.highlightDropArea=function(t){this.uploadContainer.classList.add("bs-ring"),this.uploadContainer.classList.add("bc-blue-300"),t.preventDefault(),t.stopPropagation()},t.prototype.unhighlightDropArea=function(t){this.uploadContainer.classList.remove("bs-ring"),this.uploadContainer.classList.remove("bc-blue-300"),t.preventDefault(),t.stopPropagation()},t.prototype.handleFileSelection=function(t){this.resetImagePreview();var e=this.uploadField.files;t.state.selection.$from.parent.inlineContent&&e.length&&this.showImagePreview(e[0])},t.prototype.handleDrop=function(t,e){this.resetImagePreview();var n=t.dataTransfer.files;e.state.selection.$from.parent.inlineContent&&n.length&&this.showImagePreview(n[0])},t.prototype.handlePaste=function(t,e){this.resetImagePreview();var n=t.clipboardData.files;e.state.selection.$from.parent.inlineContent&&n.length&&this.showImagePreview(n[0])},t.prototype.validateImage=function(t){return-1===["image/jpeg","image/png","image/gif"].indexOf(t.type)?P.InvalidFileType:t.size>=2097152?P.FileTooLarge:P.Ok},t.prototype.showValidationError=function(t,e){void 0===e&&(e="warning"),this.uploadField.value=null;var n=this.uploadContainer.querySelector(".js-validation-message");"warning"===e?(n.classList.remove("s-notice__danger"),n.classList.add("s-notice__warning")):(n.classList.remove("s-notice__warning"),n.classList.add("s-notice__danger")),n.classList.remove("d-none"),n.innerHTML=t},t.prototype.hideValidationError=function(){var t=this.uploadContainer.querySelector(".js-validation-message");t.classList.add("d-none"),t.classList.remove("s-notice__warning"),t.classList.remove("s-notice__danger"),t.innerHTML=""},t.prototype.showImagePreview=function(t){var e=this;return new Promise((function(n,r){return e.showImagePreviewAsync(t,n,r)}))},t.prototype.showImagePreviewAsync=function(t,e,n){var r=this,o=this.uploadContainer.querySelector(".js-image-preview"),i=this.uploadContainer.querySelector(".js-add-image");switch(this.hideValidationError(),this.validateImage(t)){case P.FileTooLarge:return this.showValidationError("Your image is too large to upload (over 2 MiB)"),void n("file too large");case P.InvalidFileType:return this.showValidationError("Please select an image (jpeg, png, gif) to upload"),void n("invalid filetype")}this.resetImagePreview();var a=new FileReader;a.addEventListener("load",(function(){var n=new Image;n.className="hmx1 w-auto",n.title=t.name,n.src=a.result,o.appendChild(n),o.classList.remove("d-none"),r.image=t,i.disabled=!1,e()}),!1),a.readAsDataURL(t)},t.prototype.resetImagePreview=function(){this.uploadContainer.querySelector(".js-image-preview").innerHTML="",this.image=null,this.uploadContainer.querySelector(".js-add-image").disabled=!0},t.prototype.resetUploader=function(){this.resetImagePreview(),this.hideValidationError()},t.prototype.handleUploadTrigger=function(t,e,n){e&&(this.startImageUpload(n,e),this.resetUploader(),$(n),n.focus())},t.prototype.startImageUpload=function(t,e){var n,r=this,o={},i=t.state.tr;if(i.selection.empty||i.deleteSelection(),K.setMeta(i,{add:{id:o,pos:i.selection.from},file:null,visible:!1}),t.dispatch(i),null===(n=this.uploadOptions)||void 0===n?void 0:n.handler)return this.uploadOptions.handler(e).then((function(e){var n=K.getState(t.state).decorations.find(null,null,(function(t){return t.id==o})),i=n.length?n[0].from:null;if(null!==i){var a=r.addTransactionDispatcher(t.state,e,i);a=K.setMeta(a,{remove:{id:o},visible:!1,file:null}),t.dispatch(a)}}),(function(){t.dispatch(K.setMeta(t.state.tr,{remove:{id:o},visible:!1,file:null})),U(t),r.showValidationError("Image upload failed. Please try again.","error")}));console.error("No upload handler registered. Ensure you set a proper handler on the editor's options.imageUploadHandler")},t.prototype.update=function(t){var e=K.getState(t.state),n=null==e?void 0:e.visible;"boolean"!=typeof n&&(n=!1),n!==this.isVisible&&(this.isVisible=n,this.image=(null==e?void 0:e.file)||this.image,this.isVisible?(this.uploadContainer.classList.remove("d-none"),this.uploadContainer.querySelector("button").focus(),this.image&&this.showImagePreview(this.image)):(this.resetUploader(),this.uploadContainer.classList.add("d-none"),this.uploadContainer.classList.remove("outline-ring")))},t.prototype.destroy=function(){this.uploadField.remove(),this.uploadContainer.remove(),this.image=null},t}();function $(t){var e=K.getState(t.state);if(e&&e.visible){var n=t.state.tr;K.setMeta(n,{visible:!1,file:null});var r=t.state.apply(n);t.updateState(r)}}function U(t,e){var n=K.getState(t.state);if(n&&!n.visible){var r=t.state.tr;K.setMeta(r,{visible:!0,file:e||null});var o=t.state.apply(r);t.updateState(o)}}function W(t){return!!K.getState(t.state)}function G(t,e,n){return(null==t?void 0:t.handler)?new N({key:K,state:{init:function(){return{visible:!1,decorations:s.DecorationSet.empty,file:null}},apply:function(t,e){var n=e.decorations||s.DecorationSet.empty;n=n.map(t.mapping,t.doc);var r,o=this.getMeta(t),i={visible:e.visible,file:e.file,decorations:n};if(!o)return i;if("visible"in o&&(i.visible=o.visible),i.file="file"in o?o.file:null,o.add){var a=s.Decoration.widget(o.add.pos,((r=document.createElement("div")).className="ws-normal d-block m8",r.innerHTML='\n<div class="py6 px12 bg-black-050 bar-sm grid gsx gs8 d-inline-flex ai-center fw-normal fs-body1">\n    <span class="icon-bg iconImage"></span>\n    <div class="grid--cell">Uploading image</div>\n    <div class="s-spinner s-spinner__sm grid--cell">\n        <div class="v-visible-sr">Loadingâ€¦</div>\n    </div>\n</div>\n',r),{id:o.add.id});i.decorations=n.add(t.doc,[a])}else o.remove&&(i.decorations=n.remove(n.find(null,null,(function(t){return t.id==o.remove.id}))));return i}},props:{decorations:function(t){return this.getState(t).decorations},handleClick:function(t){return $(t),!1},handleDrop:function(t,e){var n=e.dataTransfer.files;return!(!t.state.selection.$from.parent.inlineContent||!n.length||(U(t,n[0]),0))},handlePaste:function(t,e){var n=e.clipboardData.files;return!(!t.state.selection.$from.parent.inlineContent||!n.length||($(t),U(t,n[0]),0))}},view:function(r){return new R(r,t,(e=e||function(t){return t.dom.parentElement})(r),n)}}):new a.Plugin({})}var K=new B(R.name),Y=new a.PluginKey(Q.name);function J(t){return!Y.getState(t)}function X(t,e,n){if(Y.getState(e)===t)return!1;var r=e.tr.setMeta(Y,t);return r=r.setMeta("addToHistory",!1),n&&n(r),!0}function Q(){return new a.Plugin({key:Y,state:{init:function(){return!1},apply:function(t,e){var n=t.getMeta(Y);return void 0===n?e:n}}})}var Z=function(t,e){for(var n=0,r=e.length,o=t.length;n<r;n++,o++)t[o]=e[n];return t};function tt(t,e){return nt(t,e)}function et(t){return t instanceof Object&&!(t instanceof Function)&&!(t instanceof Array)}function nt(t,e){if(t instanceof Array&&e instanceof Array)return Z(Z([],t),e);var n=et(t),r=et(e);if(!n&&r)return nt({},e);if(n&&!r)return nt({},t);if(!n&&!r)return e;for(var o={},i=t,a=e,s=Object.keys(i),l=0,c=s;l<c.length;l++)o[p=c[l]]=p in a?nt(i[p],a[p]):i[p];for(var u=0,d=s=Object.keys(a);u<d.length;u++){var p;(p=d[u])in o||(o[p]=a[p])}return o}function rt(t,e){return!(t&&e&&t.selection.eq(e.selection)&&t.doc.eq(e.doc)&&t.storedMarks===e.storedMarks)}var ot=/^((https?|ftp):\/\/|\/)[-a-z0-9+&@#/%?=~_|!:,.;()*[\]$]+/,it=/^mailto:[#-.\w]+@[-a-z0-9]+(\.[-a-z0-9]+)*\.[a-z]+/;function at(t){var e=null==t?void 0:t.trim().toLowerCase();return ot.test(e)||it.test(e)}var st={snippets:!0,html:!0,extraEmphasis:!0,tables:!0,tagLinks:{allowMetaTags:!0,allowNonAscii:!1}},lt=function(){function t(){}return Object.defineProperty(t.prototype,"document",{get:function(){return this.editorView.state.doc},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dom",{get:function(){return this.editorView.dom},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"readonly",{get:function(){return!this.editorView.editable},enumerable:!1,configurable:!0}),t.prototype.focus=function(){var t;null===(t=this.editorView)||void 0===t||t.focus()},t.prototype.destroy=function(){var t;null===(t=this.editorView)||void 0===t||t.destroy()},Object.defineProperty(t.prototype,"content",{get:function(){return this.serializeContent()},set:function(t){var e=this.editorView.state.tr,n=this.editorView.state.doc,r=this.parseContent(t);e=e.replaceWith(0,n.content.size,r),this.editorView.dispatch(e)},enumerable:!1,configurable:!0}),t}(),ct=function(){return!1},ut=function(){function t(e,n){var r,o=this;this.items=e,this.view=n,this.menuCommands=(r=[]).concat.apply(r,this.items.map((function(t){return t.children?function(t,e){for(var n=0,r=e.length,o=t.length;n<r;n++,o++)t[o]=e[n];return t}([t],t.children):t}))),this.dom=document.createElement("div"),this.dom.className="grid gs2 mln4 fl1 ai-center js-editor-menu",this.items.forEach((function(t){var e=t.dom;return o.dom.appendChild(e)})),this.update(n,null);var i=this.menuCommands;this.dom.addEventListener("click",(function(e){var r=e.target.closest(".js-editor-btn");if(r&&!r.classList.contains(t.disabledClass)){var o=r.dataset.key;e.preventDefault(),n.focus();var a=i.find((function(t){return t.key===o}));a&&a.command(n.state,n.dispatch.bind(n),n)}})),this.readonly=!n.editable}return t.prototype.update=function(e,n){var r=this;if(rt(n,e.state)||this.readonly===e.editable){this.readonly=!e.editable,this.dom.classList.toggle("pe-none",this.readonly);var o=this.readonly,i="is-selected",a="d-none",s=t.disabledClass;this.menuCommands.forEach((function(t){var e=t.dom;if(!e.classList.contains("js-editor-btn")){var n=e.querySelector(".js-editor-btn");e=null!=n?n:e}var l=r.view.hasFocus(),c=!t.visible||t.visible(r.view.state),u=!(!l||!t.active)&&t.active(r.view.state),d=!o&&t.command(r.view.state,void 0,r.view);e.classList.remove(s),e.classList.remove(i),e.classList.remove(a),e.dataset.key=t.key,c?u?e.classList.add(i):d||e.classList.add(s):e.classList.add(a)}))}},t.prototype.destroy=function(){this.dom.remove()},t.disabledClass="is-disabled",t}();function dt(t,e){return e?t:null}function pt(t,e){var n=t.filter((function(t){return!!t}));return new a.Plugin({view:function(t){var r=new ut(n,t),o=(e=e||function(t){return t.dom.parentNode})(t);return o.contains(t.dom)?o.insertBefore(r.dom,t.dom):o.insertBefore(r.dom,o.firstChild),r}})}function ft(t,e,n,r){var o,i=document.createElement("button");i.className="s-editor-btn grid--cell js-editor-btn js-"+n,r&&(o=i.classList).add.apply(o,r),i.title=e,i.dataset.controller="s-tooltip",i.dataset.sTooltipPlacement="top",i.dataset.key=n,i.type="button";var a=document.createElement("span");return a.className="icon-bg icon"+t,i.append(a),i}function ht(t,e){var n,r=document.createElement("div");return r.className="grid--cell w16",e&&(n=r.classList).add.apply(n,e),{key:"spacer",command:ct,active:ct,visible:t,dom:r}}function mt(t,e,n){var r=document.createElement("button");return r.type="button",r.className="s-btn s-btn__unset grid--cell ta-left px12 py4 h:bg-black-050 c-pointer js-editor-btn",r.dataset.key=n,r.innerHTML=t,{key:n,command:e,dom:r}}function gt(t,e){var n=document.createElement("span");return n.className="grid--cell ta-left fs-fine tt-uppercase mx12 mb6 mt12 fc-black-400",n.dataset.key=e,n.innerHTML=t,{key:e,command:function(){return!0},visible:function(){return!0},active:function(){return!1},dom:n}}function vt(t,e,n){var r=document.createElement("a");r.className="s-editor-btn js-editor-btn grid--cell",r.href=n,r.target="_blank",r.title=e,r.dataset.controller="s-tooltip",r.dataset.sTooltipPlacement="top";var o=document.createElement("span");return o.className="icon-bg icon"+t,r.append(o),{key:e,command:function(t,e){return e&&window.open(r.href,r.target),!!n},active:ct,dom:r}}var bt=function(t){return _t.bind(null,t)},kt=function(t){return wt.bind(null,t)},yt=function(t,e){return t.text(e)};function wt(t,e,n){return!!function(t,e,n){if(e.selection.empty)return!1;var r=e.selection,o=r.from,i=r.to,s=e.doc.textBetween(o,i),l=s.slice(0,t.length),c=s.slice(-1*t.length);if(l!==t||c!==t)return!1;if(n){var u=e.tr,d=s.slice(t.length,-1*t.length);u.replaceSelectionWith(yt(u.doc.type.schema,d)),u.setSelection(a.TextSelection.create(e.apply(u).doc,o,i-2*t.length)),n(u)}return!0}(t,e,n)||function(t,e,n){var r="your text",o=e.selection,i=o.from,s=o.to,l=e.tr.insertText(t,s);if(e.selection.empty&&l.insertText(r,s),l.insertText(t,i).scrollIntoView(),n){var c=i,u=s+2*t.length;e.selection.empty&&(u=(c=i+t.length)+r.length),l.setSelection(a.TextSelection.create(e.apply(l).doc,c,u)),n(l)}return!0}(t,e,n)}function _t(t,e,n){return!!function(t,e,n){if(e.selection.empty)return!1;var r=e.selection.from,o=e.doc.cut(r,e.selection.to).textContent;if(!o.includes("\n"))return!1;var i=" ",s=e.tr,l=o.split("\n"),c=l.some((function(e){return!e.startsWith(t+i)})),u=r;if(l.forEach((function(e){var n,r=Ct(e);n=c&&r===t+i?e:c&&r.length?t+i+e.slice(r.length):c?t+i+e:e.slice(r.length);var o=u+e.length;s=n.length?s.replaceRangeWith(u,o,yt(s.doc.type.schema,n)):s.deleteRange(u,o),u+=n.length+"\n".length})),r>1&&"\n"!==e.doc.textBetween(r-1,r)&&(s=s.insertText("\n",r,r),r+="\n".length,u+="\n".length),n){var d=u-"\n".length;s.setSelection(a.TextSelection.create(e.apply(s).doc,r,d)),s.scrollIntoView(),n(s)}return!0}(t,e,n)||function(t,e,n){var r,o=e.selection.from,i=e.doc.cut(0,o).textContent.lastIndexOf("\n");r=-1===i?1:i+1+"\n".length;var a=Ct(e.doc.cut(r).textContent),s=e.tr;a.length&&(s=s.delete(r,r+a.length));var l=!1;return a===t+" "&&(l=!0),l||(s=s.insertText(t+" ",r)),n&&n(s=s.scrollIntoView()),!0}(t,e,n)}function Ct(t){var e;return(null===(e=/^[^a-zA-Z]+\s{1}(?=[a-zA-Z_*[!]|$)/.exec(t))||void 0===e?void 0:e[0])||""}function St(t,e,n){if(e.selection.empty)return!1;var r=e.selection,o=r.from,i=r.to,s=e.doc.textBetween(o,i),l=t.length+"\n".length,c=s.slice(0,l),u=s.slice(-1*l);if(c!==t+"\n"||u!=="\n"+t)return!1;var d=e.tr;return d=(d=d.delete(i-l,i)).delete(o,o+l),n&&(d.setSelection(a.TextSelection.create(e.apply(d).doc,o,i-2*l)),d.scrollIntoView(),n(d)),!0}function xt(t,e,n,r,o){var i=r.tr,s=r.selection.from;return i=r.selection.empty?i.insertText(t,s):i.replaceSelectionWith(yt(i.doc.type.schema,t)),o&&o(i=(i=void 0!==e&&void 0!==n?i.setSelection(a.TextSelection.create(r.apply(i).doc,s+e,s+n)):i.setSelection(a.TextSelection.create(r.apply(i).doc,s))).scrollIntoView()),!0}function Et(t,e){var n="https://www.stackoverflow.com/";if(t.selection.empty)return xt("[text]("+n+")",1,5,t,e);var r=t.selection,o=r.from,i=r.to,a=t.doc.textBetween(o,i),s="["+a+"]("+n+")",l=3+a.length;return xt(s,l,l+n.length,t,e)}function Lt(t,e){if(t.selection.empty)return xt("\n| Column A | Column B |\n| -------- | -------- |\n| Cell 1   | Cell 2   |\n| Cell 3   | Cell 4   |\n",1,1,t,e)}var Mt=kt("**"),Ot=kt("*"),Tt=kt("`"),Pt=function(){return!1},jt=bt("#"),It=kt("~~"),At=bt(">"),Dt=bt("1."),Vt=bt("-"),Bt=("\n---\n",xt.bind(null,"\n---\n",undefined,undefined)),Nt=("```",function(t,e,n){return!!St(t,e,n)||function(t,e,n){if(e.selection.empty){var r="type here";return xt("\n"+t+"\n"+"type here\n"+t+"\n",t.length+2,t.length+r.length+2,e,n)}var o=e.selection,i=o.from,s=o.to;if(St(t,e,n))return!0;var l=e.tr;i>0&&"\n"!==e.doc.textBetween(i-1,i)&&(l=l.insertText("\n",i,i),i+=1,s+=1),s+1<e.doc.content.size&&"\n"!==e.doc.textBetween(s,s+1)&&(l=l.insertText("\n",s+1,s+1),s+=1);if(l.insertText("\n"+t,s),l.insertText(t+"\n",i),n){var c="\n".length+t.length;l.setSelection(a.TextSelection.create(e.apply(l).doc,i,s+2*c)),l.scrollIntoView(),n(l)}return!0}(t,e,n)}.bind(null,"```"));function zt(t,e,n){return!(!W(n)||e&&(U(n),0))}var Ft=function(t){var e;return pt([{key:"toggleHeading",command:jt,dom:ft("Header","Heading","heading-btn")},{key:"togglBold",command:Mt,dom:ft("Bold","Bold","bold-btn")},{key:"toggleEmphasis",command:Ot,dom:ft("Italic","Italic","italic-btn")},{key:"toggleCode",command:Tt,dom:ft("Code","Inline code","code-btn")},dt({key:"toggleStrikethrough",command:It,dom:ft("Strikethrough","Strikethrough","strike-btn")},t.parserFeatures.extraEmphasis),ht(),{key:"toggleLink",command:Et,dom:ft("Link","Insert link","insert-link-btn")},{key:"toggleBlockquote",command:At,dom:ft("Quote","Blockquote","blockquote-btn")},{key:"insertCodeblock",command:Nt,dom:ft("Codeblock","Insert code block","code-block-btn")},dt({key:"insertImage",command:zt,dom:ft("Image","Insert image","insert-image-btn")},!!(null===(e=t.imageUpload)||void 0===e?void 0:e.handler)),dt({key:"insertTable",command:Lt,dom:ft("Table","Insert table","insert-table-btn")},t.parserFeatures.tables),ht(),{key:"toggleOrderedList",command:Dt,dom:ft("OrderedList","Numbered list","numbered-list-btn")},{key:"toggleUnorderedList",command:Vt,dom:ft("UnorderedList","Bulleted list","bullet-list-btn")},{key:"insertRule",command:Bt,dom:ft("HorizontalRule","Insert Horizontal rule","horizontal-rule-btn")},ht((function(){return!1}),["sm:d-inline-block"]),{key:"undo",command:o.Yw,dom:ft("Undo","Undo","undo-btn",["sm:d-inline-block"]),visible:function(){return!1}},{key:"redo",command:o.KX,dom:ft("Refresh","Redo","redo-btn",["sm:d-inline-block"]),visible:function(){return!1}},ht(),vt("Help","Help",t.editorHelpLink)],t.menuParentContainer)},Ht=(0,i.h)({"Mod-z":o.Yw,"Mod-y":o.KX,"Mod-Shift-z":o.KX,Tab:Pt,"Shift-Tab":Pt,"Mod-b":Mt,"Mod-i":Ot,"Mod-l":Et,"Ctrl-q":At,"Mod-k":Tt,"Mod-g":zt,"Ctrl-g":zt,"Mod-o":Dt,"Mod-u":Vt,"Mod-h":jt,"Mod-r":Bt,"Mod-m":Nt}),qt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Rt=function(t){function e(n,l,c){void 0===c&&(c={});var u,p,f=t.call(this)||this;return f.options=tt(e.defaultOptions,c),f.editorView=new s.EditorView((function(t){var e;(e=t.classList).add.apply(e,f.options.classList),n.appendChild(t)}),{editable:J,state:a.EditorState.create({doc:f.parseContent(l),plugins:[(0,o.m8)(),Ht,(0,i.h)(r.YR),Ft(f.options),d(null),(u=f.options.imageUpload,p=f.options.pluginParentContainer,G(u,p,(function(t,e,n){var r="enter image description here",o="!["+r+"]("+e+")",i=n+2,s=i+r.length;u.wrapImagesInLinks&&(o="["+o+"]("+e+")",i+=1,s+=1);var l=t.tr.insertText(o,n);return l.setSelection(a.TextSelection.create(t.apply(l).doc,i,s)),l}))),Q()]})}),h("prosemirror commonmark document",f.editorView.state.doc.toJSON()),f}return qt(e,t),Object.defineProperty(e,"defaultOptions",{get:function(){return{editorHelpLink:null,menuParentContainer:null,parserFeatures:st,imageUpload:{handler:q}}},enumerable:!1,configurable:!0}),e.prototype.parseContent=function(t){return D.fromSchema(A).parseCode(t)},e.prototype.serializeContent=function(){return D.toString(this.editorView.state.doc)},e}(lt),$t=n(1081);function Ut(t,e){t.contentMatch=k.sI.parse(t.spec.content||"",e.nodes),t.inlineContent=t.contentMatch.inlineContent}var Wt,Gt=n(7024),Kt=n.n(Gt),Yt=n(5872),Jt=n.n(Yt);!function(t){t[t.unknown=0]="unknown",t[t.comment=1]="comment",t[t.strike=2]="strike",t[t.strong=3]="strong",t[t.emphasis=4]="emphasis",t[t.hardbreak=5]="hardbreak",t[t.code=6]="code",t[t.link=7]="link",t[t.image=8]="image",t[t.keyboard=9]="keyboard",t[t.pre=10]="pre",t[t.sup=11]="sup",t[t.sub=12]="sub",t[t.heading=13]="heading",t[t.paragraph=14]="paragraph",t[t.horizontal_rule=15]="horizontal_rule",t[t.blockquote=16]="blockquote",t[t.list_item=17]="list_item",t[t.ordered_list=18]="ordered_list",t[t.unordered_list=19]="unordered_list",t[t.dd=20]="dd",t[t.dl=21]="dl",t[t.dt=22]="dt"}(Wt||(Wt={}));var Xt=[Wt.blockquote,Wt.heading,Wt.list_item,Wt.ordered_list,Wt.unordered_list,Wt.dd,Wt.dl,Wt.dt,Wt.paragraph,Wt.horizontal_rule,Wt.pre];function Qt(t){var e,n,r,o,i,a,s;if(!t)return{type:Wt.unknown,isSelfClosing:!1,isClosing:!1,isBlock:!1,tagName:null,attributes:{},markup:null};var l=Wt.unknown,c=/^<\/\S+?.*?>$/.test(t),u=t.replace(/[<>/]/g,"").trim().split(/\s/)[0],d=!1,p={};["del","strike","s"].includes(u)?l=Wt.strike:["b","strong"].includes(u)?l=Wt.strong:["em","i"].includes(u)?l=Wt.emphasis:"code"===u?l=Wt.code:"br"===u?(l=Wt.hardbreak,d=!0):"blockquote"===u?l=Wt.blockquote:"a"===u?(l=Wt.link,p.href=(null===(e=/href=["'](.+?)["']/.exec(t))||void 0===e?void 0:e[1])||"",p.title=(null===(n=/title=["'](.+?)["']/.exec(t))||void 0===n?void 0:n[1])||""):"img"===u?(l=Wt.image,p.src=(null===(r=/src=["'](.+?)["']/.exec(t))||void 0===r?void 0:r[1])||"",p.width=(null===(o=/width=["'](.+?)["']/.exec(t))||void 0===o?void 0:o[1])||"",p.height=(null===(i=/height=["'](.+?)["']/.exec(t))||void 0===i?void 0:i[1])||"",p.alt=(null===(a=/alt=["'](.+?)["']/.exec(t))||void 0===a?void 0:a[1])||"",p.title=(null===(s=/title=["'](.+?)["']/.exec(t))||void 0===s?void 0:s[1])||"",d=!0):/h[1,2,3,4,5,6]/.test(u)?l=Wt.heading:"kbd"===u?l=Wt.keyboard:"pre"===u?l=Wt.pre:"sup"===u?l=Wt.sup:"sub"===u?l=Wt.sub:"ul"===u?l=Wt.unordered_list:"ol"===u?l=Wt.ordered_list:"li"===u?l=Wt.list_item:"p"===u?l=Wt.paragraph:"hr"===u?(l=Wt.horizontal_rule,d=!0):l=Wt.unknown;var f=u?"<"+(c?"/":"")+u+">":"";return d&&(f=t.replace(/^(<[a-z]+).*?(\s?\/?>)$/i,"$1$2")),{type:l,isSelfClosing:d,isClosing:c,isBlock:Xt.includes(l),tagName:u,attributes:p,markup:f}}function Zt(t,e){var n=e||new(Jt())("","",0),r=t.isSelfClosing?"":t.isClosing?"_close":"_open",o="";switch(t.type){case Wt.unknown:o="text";break;case Wt.strike:o="s"+r;break;case Wt.emphasis:o="em"+r;break;case Wt.code:o="code_inline";break;case Wt.horizontal_rule:o="hr";break;case Wt.link:o="link"+r,n.attrSet("href",t.attributes.href),n.attrSet("title",t.attributes.title);break;case Wt.image:o="image",n.attrSet("src",t.attributes.src),n.attrSet("height",t.attributes.height),n.attrSet("width",t.attributes.width),n.attrSet("alt",t.attributes.alt),n.attrSet("title",t.attributes.title);break;case Wt.keyboard:o="kbd"+r;break;default:o=Wt[t.type]+r}return n.type=o,n.markup=t.markup,n.nesting=t.isClosing?-1:1,t.isSelfClosing&&(n.nesting=0),n.tag=t.tagName||"",n}function te(t,e){if(t.block)return[t];var n=[Wt.blockquote,Wt.pre],r=new(Jt())("inline","",0);return r.children=[t],!e||n.includes(e)?[new(Jt())("paragraph_open","p",1),r,new(Jt())("paragraph_close","p",-1)]:[r]}function ee(t){var e=null;return"html_inline"===t.type?e=Qt(t.content):t.children&&t.children.length&&(t.children=ne(t.children)),e?(e.isBlock||(t=Zt(e,t)).attrSet("inline_html","true"),t):t}function ne(t){for(var e=0,n=(t=t.map(ee).filter((function(t){return!!t}))).length;e<n;e++){var r=t[e];if(r.attrGet("inline_html"))if(!r.type.includes("_close")||r.attrGet("paired")){if(r.type.includes("_open")){for(var o=!1,i=e+1,a=t.length;i<a;i++){var s=t[i];if(s&&s.attrGet("inline_html")&&!s.attrGet("paired")&&r.tag===s.tag){o=!0,s.attrSet("paired","true");break}}o||(r.type="html_inline")}}else r.type="html_inline"}return t}function re(t){var e,n=null===(e=t.match(/(<\/?[a-z]+.*?>)/gi))||void 0===e?void 0:e.map((function(t){return{match:t,tagInfo:Qt(t)}}));if(!n||!n.length)return t;var r=t;return n.forEach((function(t){var e;if(t.tagInfo.type===Wt.unknown)e="";else if(t.tagInfo.type===Wt.image){var n=t.match.match(/((width|height|src|alt|title)=["'].+?["'])/g),o=t.tagInfo.markup;(null==n?void 0:n.length)&&(o=o.replace("<img","<img "+n.join(" "))),e=o}else t.tagInfo.type===Wt.link?(n=t.match.match(/((href|title)=["'].+?["'])/g),o=t.tagInfo.markup,(null==n?void 0:n.length)&&(o=o.replace("<a","<a "+n.join(" "))),e=o):e=t.tagInfo.markup;r=r.replace(t.match,e)})),r}function oe(t){var e=[];return t.forEach((function(t){var n,r=null;if("html_block"===t.type?r=function(t){var e=t.content,n=/^(?:(<[a-z0-9]+.*?>)([^<>]+?)(<\/[a-z0-9]+>))$|^(<[a-z0-9]+(?:\s.+?)?\s?\/?>)$/i.exec(e);if(!n)return null;var r=[],o=!1;if(n[4]){var i=Qt(e);i.type!==Wt.unknown&&(o=i.isBlock,r.push(i))}else{var a=Qt(n[1]),s=n[2],l=Qt(n[3]);a.type!==Wt.unknown&&l.type!==Wt.unknown&&a.type===l.type&&(o=a.isBlock,r.push(a),r.push(s),r.push(l))}return r.length>0?{isBlock:o,tagInfo:r}:null}(t):(null===(n=t.children)||void 0===n?void 0:n.length)&&(t.children=oe(t.children)),r&&r.tagInfo.length){var o=[];r.tagInfo.forEach((function(t,e,n){var r,i=n[e-1],a="string"==typeof t||!t.isBlock;if("string"==typeof t){var s=new(Jt())("text","",0);s.content=t,r=s}else r=Zt(t);var l=[r];a&&(l=te(r,null==i?void 0:i.type)),o.push.apply(o,l)})),e.push.apply(e,o)}else e.push(t)})),e}function ie(t){var e=[];return t.forEach((function(t){var n;if((null===(n=t.children)||void 0===n?void 0:n.length)&&(t.children=ie(t.children)),0===t.type.indexOf("html_block"))if("html_block"===t.type){if(t.content=re(t.content),!t.content.trim())return;if(t.content.includes("<"))e.push(t);else{var r=new(Jt())("text","",0);r.content=t.content;var o=te(r,null);e.push.apply(e,o)}}else if("html_block_container_open"===t.type){var i=t.attrGet("contentOpen"),a=t.attrGet("contentClose");t.attrSet("contentOpen",re(i)),t.attrSet("contentClose",re(a)),e.push(t)}else e.push(t);else e.push(t)})),e}function ae(t){var e=[],n=0,r=t.map((function(t,e){var r,o,i,a;if("html_block"!==t.type)return null;var s=null!==(o=null===(r=t.content.match(/<[a-z]+(\s[a-z0-9\-"'=\s])?>/gi))||void 0===r?void 0:r.length)&&void 0!==o?o:0,l=null!==(a=null===(i=t.content.match(/<\/[a-z]+>/gi))||void 0===i?void 0:i.length)&&void 0!==a?a:0;return s>l||s<l&&n%2==1?(n+=1,e):null})).filter((function(t){return null!==t}));r.length%2==1&&(r=r.slice(0,-1));var o=null;return t.forEach((function(t,n){if(t.children&&t.children.length&&(t.children=ae(t.children)),"html_block"===t.type&&r.includes(n)){var i=new(Jt())("html_block_container_"+(o?"close":"open"),"",o?-1:1);o?(o.attrSet("contentClose",t.content),o=null,e.push(i)):(i.attrSet("contentOpen",t.content),o=i,e.push(i))}else e.push(t)})),e}function se(t){t.core.ruler.push("so-sanitize-html",(function(t){return t.tokens=ne(t.tokens),t.tokens=oe(t.tokens),t.tokens=ae(t.tokens),t.tokens=ie(t.tokens),!1}))}function le(t,e,n,r,o){var i,a,s,l,c,u,d,p,f,h,m,g,b,k,y,w,_,C,S,x,E=e.lineMax,L=e.bMarks[n]+e.tShift[n],M=e.eMarks[n];if(e.sCount[n]-e.blkIndent>=4)return!1;if(62!==e.src.charCodeAt(L)||!t.followingCharRegex.test(e.src[L+1]))return!1;if(L+=t.markup.length,o)return!0;for(l=f=e.sCount[n]+L-(e.bMarks[n]+e.tShift[n]),32===e.src.charCodeAt(L)?(L++,l++,f++,i=!1,w=!0):9===e.src.charCodeAt(L)?(w=!0,(e.bsCount[n]+f)%4==3?(L++,l++,f++,i=!1):i=!0):w=!1,h=[e.bMarks[n]],e.bMarks[n]=L;L<M&&(a=e.src.charCodeAt(L),(0,v.isSpace)(a));)9===a?f+=4-(f+e.bsCount[n]+(i?1:0))%4:f++,L++;for(m=[e.bsCount[n]],e.bsCount[n]=e.sCount[n]+1+(w?1:0),u=L>=M,k=[e.sCount[n]],e.sCount[n]=f-l,y=[e.tShift[n]],e.tShift[n]=L-e.bMarks[n],C=e.md.block.ruler.getRules("spoiler"),b=e.parentType,e.parentType="spoiler",x=!1,p=n+1;p<r&&(e.sCount[p]<e.blkIndent&&(x=!0),!((L=e.bMarks[p]+e.tShift[p])>=(M=e.eMarks[p])));p++)if(L+=t.markup.length,62!==e.src.charCodeAt(L-t.markup.length)||!t.followingCharRegex.test(e.src[L-t.markup.length+1])||x){if(u)break;for(_=!1,s=0,c=C.length;s<c;s++)if(C[s](e,p,r,!0)){_=!0;break}if(_){e.lineMax=p,0!==e.blkIndent&&(h.push(e.bMarks[p]),m.push(e.bsCount[p]),y.push(e.tShift[p]),k.push(e.sCount[p]),e.sCount[p]-=e.blkIndent);break}h.push(e.bMarks[p]),m.push(e.bsCount[p]),y.push(e.tShift[p]),k.push(e.sCount[p]),e.sCount[p]=-1}else{for(l=f=e.sCount[p]+L-(e.bMarks[p]+e.tShift[p]),32===e.src.charCodeAt(L)?(L++,l++,f++,i=!1,w=!0):9===e.src.charCodeAt(L)?(w=!0,(e.bsCount[p]+f)%4==3?(L++,l++,f++,i=!1):i=!0):w=!1,h.push(e.bMarks[p]),e.bMarks[p]=L;L<M&&(a=e.src.charCodeAt(L),(0,v.isSpace)(a));)9===a?f+=4-(f+e.bsCount[p]+(i?1:0))%4:f++,L++;u=L>=M,m.push(e.bsCount[p]),e.bsCount[p]=e.sCount[p]+1+(w?1:0),k.push(e.sCount[p]),e.sCount[p]=f-l,y.push(e.tShift[p]),e.tShift[p]=L-e.bMarks[p]}for(g=e.blkIndent,e.blkIndent=0,(S=e.push(t.name+"_open",t.name,1)).markup=t.markup,S.map=d=[n,0],e.md.block.tokenize(e,n,p),(S=e.push(t.name+"_close",t.name,-1)).markup=t.markup,e.lineMax=E,e.parentType=b,d[1]=e.line,s=0;s<y.length;s++)e.bMarks[s+n]=h[s],e.tShift[s+n]=y[s],e.sCount[s+n]=k[s],e.bsCount[s+n]=m[s];return e.blkIndent=g,!0}function ce(t,e,n,r){return le({followingCharRegex:/!/,markup:">!",name:"spoiler"},t,e,n,r)}function ue(t,e,n,r){return le({followingCharRegex:/[^!]/,markup:">",name:"blockquote"},t,e,n,r)}function de(t){t.block.ruler.__rules__.forEach((function(t){var e=t.alt.indexOf("blockquote");e>-1&&t.alt.splice(e,0,"spoiler")})),t.block.ruler.before("blockquote","spoiler",ce,{alt:["paragraph","reference","spoiler","blockquote","list"]}),t.block.ruler.at("blockquote",ue,{alt:["paragraph","reference","spoiler","blockquote","list"]})}function pe(t,e,n,r,o,i){var a=n.bMarks[r]+n.tShift[r],s=n.eMarks[r];if(60!==n.src.charCodeAt(a)||a+2>=s)return!1;if(33!==n.src.charCodeAt(a+1))return!1;var l=n.src.slice(a,s),c=t.exec(l);if(!(null==c?void 0:c.length))return!1;if(i)return!0;var u=r+1;n.line=u;var d=n.push(e,"",0);return d.map=[r,u],d.content=n.getLines(r,u,n.blkIndent,!0),d.attrSet("language",c[1]),!0}function fe(t,e,n,r){return pe(/<!-- language: lang-(.+?) -->/,"stack_language_comment",t,e,0,r)}function he(t,e,n,r){return pe(/<!-- language-all: lang-(.+?) -->/,"stack_language_all_comment",t,e,0,r)}function me(t){for(var e=null,n=0,r=t.tokens;n<r.length;n++){var o=r[n];if("stack_language_all_comment"===o.type){e=o.attrGet("language");break}}for(var i=0,a=t.tokens.length;i<a;i++){var s=t.tokens[i],l=t.tokens[i+1];if("stack_language_comment"===s.type&&"code_block"===(null==l?void 0:l.type)){var c=s.attrGet("language");l.info=c}else"stack_language_all_comment"===s.type?e=s.attrGet("language"):"code_block"===s.type&&!s.info&&e&&(s.info=e)}return t.tokens=t.tokens.filter((function(t){return!t.type.startsWith("stack_language")})),!1}function ge(t){t.block.ruler.before("html_block","stack_language_comment",fe),t.block.ruler.before("html_block","stack_language_all_comment",he),t.core.ruler.push("so-sanitize-code-lang",me)}function ve(t,e){t.inline.ruler.push("tag_link",(function(t,n){return function(t,e,n){if(91!==t.src.charCodeAt(t.pos))return!1;if("[tag:"!==t.src.slice(t.pos,t.pos+5)&&"[meta-tag:"!==t.src.slice(t.pos,t.pos+10))return!1;var r=t.md.helpers.parseLinkLabel(t,t.pos+1,!1);if(r<0)return!1;var o=t.src.slice(t.pos,r+1),i="[meta-tag:"===o.slice(0,10);if(i&&!n.allowMetaTags)return!1;var a=o.slice(i?10:5,-1);if(!(n.allowNonAscii?/([a-z0-9\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF#+.-]+)/i:/([a-z0-9#+.-]+)/i).exec(a))return!1;if(!e){var s=t.push("tag_link_open","a",1);s.attrSet("tagName",a),s.attrSet("tagType",i?"meta-tag":"tag"),s.content=o,(s=t.push("text","",0)).content=a,s=t.push("tag_link_close","a",-1)}return t.pos=r+1,!0}(t,n,e)}))}function be(t){for(var e=0,n=!1,r=!1,o=0;o<t.length;o++){var i=t[o];if("bullet_list_open"!==i.type&&"ordered_list_open"!==i.type){if(i.type.startsWith("list_item_"))n=i.type.endsWith("open");else if(i.type.startsWith("paragraph_")&&n&&i.hidden)r=!0;else if("bullet_list_close"===i.type||"ordered_list_close"===i.type){e=o;break}}else{var a=be(t.slice(o+1));a.isTight&&i.attrSet("tight",a.isTight.toString()),o+=a.iteratedElements+1}}return{iteratedElements:e,isTight:r}}function ke(t){t.core.ruler.push("tight-list",(function(t){return be(t.tokens),!1}))}var ye=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),we=function(){return(we=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},_e=we(we({},b.EU.tokens),{pre:{block:"pre"},kbd:{mark:"kbd"},sup:{mark:"sup"},sub:{mark:"sub"},html_inline:{node:"html_inline",getAttrs:function(t){return{content:t.content}}},html_block:{node:"html_block",getAttrs:function(t){return{content:t.content}}},html_block_container:{block:"html_block_container",getAttrs:function(t){return{contentOpen:t.attrGet("contentOpen"),contentClose:t.attrGet("contentClose")}}},stack_language_comment:{ignore:!0},stack_language_all_comment:{ignore:!0},bullet_list:{block:"bullet_list",getAttrs:function(t){return{tight:"true"===t.attrGet("tight")}}},ordered_list:{block:"ordered_list",getAttrs:function(t){return{order:+t.attrGet("start")||1,tight:"true"===t.attrGet("tight")}}},code_block:{block:"code_block",getAttrs:function(t){return{params:t.info||""}}},s:{mark:"strike"},table:{block:"table"},thead:{block:"table_head"},tbody:{block:"table_body"},th:{block:"table_header",getAttrs:function(t){return{style:t.attrGet("style")}}},tr:{block:"table_row"},td:{block:"table_cell",getAttrs:function(t){return{style:t.attrGet("style")}}},image:{node:"image",getAttrs:function(t){var e,n;return{src:t.attrGet("src"),width:t.attrGet("width"),height:t.attrGet("height"),alt:t.attrGet("alt")||(null===(n=null===(e=t.children)||void 0===e?void 0:e[0])||void 0===n?void 0:n.content)||null,title:t.attrGet("title")}}},tag_link:{block:"tagLink",getAttrs:function(t){return{tagName:t.attrGet("tagName"),tagType:t.attrGet("tagType")}}},spoiler:{block:"spoiler"}});Object.keys(_e).forEach((function(t){var e=_e[t];if(e.getAttrs){var n=e.getAttrs.bind(e);e.getAttrs=function(t){var e=n(t);return e.markup=t.markup,e}}else e.getAttrs=function(t){return{markup:t.markup}}}));var Ce=function(t){function e(e,n,r){var o=t.call(this,e,n,r)||this;return o.tokenHandlers.softbreak=function(t){var e=o.schema.nodes.softbreak;t.openNode(e,{}),t.addText(" "),t.closeNode()},o}return ye(e,t),e}(b.xj),Se=function(t){function e(e,n){return t.call(this,e,n)||this}return ye(e,t),e.prototype.parse=function(e,n){var r=t.prototype.parse.call(this,e,n);return h("Sanitized markdown token tree",r),r},e}(Kt()),xe=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ee=function(){function t(t){var e=this,n='<div class="s-popover is-visible p4 w-auto wmx-initial wmn-initial js-link-tooltip"\n    id="link-tooltip-popover"\n    role="menu">\n    <div class="s-popover--arrow"></div>\n    <div class="grid ai-center">\n        <a href="'+this.href+'"\n            class="wmx3 grid--cell fs-body1 fw-normal d-inline-block truncate ml8 mr4"\n            target="_blank"\n            rel="nofollow noreferrer">'+this.href+'</a>\n        <div class="grid--cell d-none wmn2 ml2 mr4 mb0 js-link-tooltip-input-wrapper">\n            <input type="text"\n                    class="s-input s-input__sm js-link-tooltip-input"\n                    autocomplete="off"\n                    name="link"\n                    value="'+this.href+'" />\n        </div>\n        <button type="button"\n                class="grid--cell s-btn mr4 js-link-tooltip-edit"\n                title="Edit link"><span class="svg-icon icon-bg iconPencilSm"></span></button>\n        <button type="button"\n                class="grid--cell s-btn d-none js-link-tooltip-apply"\n                title="Apply new link">Apply</button>\n        <button type="button"\n                class="grid--cell s-btn js-link-tooltip-remove"\n                title="Remove link"><span class="svg-icon icon-bg iconTrashSm"></span></button>\n    </div>\n</div>';this.content=document.createElement("span"),this.content.className="w0",this.content.setAttribute("aria-controls","link-tooltip-popover"),this.content.setAttribute("data-controller","s-popover"),this.content.setAttribute("data-s-popover-placement","bottom"),this.content.innerHTML=n,this.content.addEventListener("s-popover:hide",(function(t){t.preventDefault()}));var r=function(t){e.applyListener.call(e,t)};this.input.addEventListener("keydown",(function(t){"Enter"===t.key&&(t.stopPropagation(),t.preventDefault(),r(t))})),this.bindElementInteraction(this.applyButton,r),this.bindElementInteraction(this.removeButton,(function(t){e.removeListener.call(e,t)})),this.bindElementInteraction(this.editButton,(function(){e.showEditMode(e.href)})),this.editing=!1,this.update(t)}return Object.defineProperty(t.prototype,"editButton",{get:function(){return this.content.querySelector(".js-link-tooltip-edit")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"applyButton",{get:function(){return this.content.querySelector(".js-link-tooltip-apply")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"removeButton",{get:function(){return this.content.querySelector(".js-link-tooltip-remove")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"link",{get:function(){return this.content.querySelector("a")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"input",{get:function(){return this.content.querySelector(".js-link-tooltip-input")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"inputWrapper",{get:function(){return this.content.querySelector(".js-link-tooltip-input-wrapper")},enumerable:!1,configurable:!0}),t.prototype.bindElementInteraction=function(t,e){var n=this;t.addEventListener("mousedown",(function(t){t.stopPropagation(),t.preventDefault(),e.call(n,t)})),t.addEventListener("keydown",(function(t){"Tab"!==t.key&&(t.stopPropagation(),t.preventDefault(),"Enter"!==t.key&&" "!==t.key||e.call(n,t))}))},t.prototype.update=function(t){if(this.isLink(t)){var e=this.findMarksInSelection(t);if(e.length>0){this.href=e[0].attrs.href;var n=this.link;n.href=n.title=n.innerText=this.href}(0,r.w9)(j.marks.link)(t)&&this.href&&this.hideEditMode(),(this.editing||""===this.href)&&this.showEditMode(this.href)}},t.prototype.getDecorations=function(t,e,n,r){var o=this;if("forceHide"in e&&e.forceHide)return s.DecorationSet.empty;if(!this.findMarksInSelection(r).length)return s.DecorationSet.empty;this.update(r);var i=s.Decoration.widget(r.selection.from,(function(t){return o.updateEventListeners(t),o.content}),{side:-1,ignoreSelection:!0,stopEvent:function(){return!0}});return s.DecorationSet.create(r.doc,[i])},t.prototype.hasFocus=function(t){return this.content.contains(t.relatedTarget)},t.prototype.isLink=function(t){var e=t.selection,n=e.from,r=e.$from,o=e.to;return e.empty?void 0!==j.marks.link.isInSet(t.storedMarks||r.marks()):t.doc.rangeHasMark(n,o,j.marks.link)},t.prototype.showEditMode=function(t){this.hideValidationError();var e=this.input;e.value=t||"https://",this.inputWrapper.classList.remove("d-none"),e.select(),this.applyButton.classList.remove("d-none"),this.editButton.classList.add("d-none"),this.link.classList.add("d-none"),e.focus()},t.prototype.hideEditMode=function(){this.editButton.classList.remove("d-none"),this.link.classList.remove("d-none"),this.inputWrapper.classList.add("d-none"),this.applyButton.classList.add("d-none")},t.prototype.showValidationError=function(){this.inputWrapper.classList.add("has-error")},t.prototype.hideValidationError=function(){this.inputWrapper.classList.remove("has-error")},t.prototype.expandSelection=function(t,e){var n=this.linkAround(t);return e.setSelection(a.TextSelection.create(e.doc,n.from,n.to))},t.prototype.linkAround=function(t){var e=t.selection.$from,n=e.parent.childAfter(e.parentOffset);if(n.node){var r=n.node.marks.find((function(e){return e.type===t.schema.marks.link}));if(r){for(var o=e.index(),i=e.start()+n.offset;o>0&&r.isInSet(e.parent.child(o-1).marks);)o-=1,i-=e.parent.child(o).nodeSize;for(var a=e.indexAfter(),s=i+n.node.nodeSize;a<e.parent.childCount&&r.isInSet(e.parent.child(a).marks);)s+=e.parent.child(a).nodeSize,a+=1;return{from:i,to:s}}}},t.prototype.findMarksInSelection=function(t){var e=[],n=t.selection,r=n.to,o=n.from,i=n.$from;if(n.empty)return i.marks().filter((function(t){return t.type===j.marks.link}));r>o&&t.doc.nodesBetween(o,r,(function(t){e.push(t.marks.filter((function(t){return t.type===j.marks.link})))}));var a=[];return a.concat.apply(a,e)},t.prototype.updateEventListeners=function(t){var e=this;this.removeListener=function(){var n=t.state;t.state.selection.empty&&(t.dispatch(e.expandSelection(n,t.state.tr)),n=t.state),(0,r.w9)(j.marks.link)(n,t.dispatch.bind(t))},this.applyListener=function(){var n=e.link,r=e.input,o=t.state.selection,i=o.from,a=o.to;if(e.editing=!1,t.focus(),n.href!==r.value)if(e.hideValidationError(),at(r.value)){if(n.href=n.title=n.innerText=r.value,t.state.selection.empty){var s=e.linkAround(t.state);i=s.from,a=s.to}var l=t.state.tr.addMark(i,a,j.marks.link.create({href:e.link.href}));t.dispatch(l)}else e.showValidationError();else e.hideEditMode()}},t}(),Le=new(function(t){function e(){return t.call(this,Ee.name)||this}return xe(e,t),e.prototype.setEditMode=function(t,e,n){var r=this.getState(e);return r.editing=t,this.setMeta(n,r)},e.prototype.forceHide=function(t,e){var n=this.getState(t);n.decorations!==s.DecorationSet.empty&&(n.forceHide=!0,e(this.setMeta(t.tr,n)))},e}(B)),Me=new N({key:Le,state:{init:function(t,e){return{linkTooltip:new Ee(e),decorations:s.DecorationSet.empty}},apply:function(t,e,n,r){var o=this.getMeta(t)||e;"forceHide"in o&&(e.forceHide=o.forceHide),e.linkTooltip.editing="editing"in o&&o.editing;var i=e.linkTooltip.getDecorations(t,e,n,r);return{linkTooltip:e.linkTooltip,decorations:i}}},props:{decorations:function(t){return this.getState(t).decorations},handleDOMEvents:{blur:function(t,e){var n=Le.getState(t.state).linkTooltip;return t.hasFocus()||n.hasFocus(e)||Le.forceHide(t.state,t.dispatch.bind(t)),!1}}}});function Oe(t){var e=Ke(t),n=(0,r.ym)(t);return function(t,r){if(!e(t))return n(t,r);var o=t.selection,i=o.$from,a=o.$to,s=i.blockRange(a),l=s&&(0,$t.k9)(s);return null!=l&&(r&&r(t.tr.lift(s,l)),!0)}}var Te=(0,r.uJ)(j.nodes.paragraph);function Pe(t,e){var n=Ke(t),o=(0,r.uJ)(t,e);return function(t,e){return n(t)?Te(t,e):o(t,e)}}function je(t,e){return!Ie(t.selection)&&(e&&e(t.tr.replaceSelectionWith(j.nodes.horizontal_rule.create())),!0)}function Ie(t){return I.includes(t.$head.parent.type)}function Ae(t){return t.$head.parent.type===j.nodes.table_header}var De=(0,r.QF)(r.uo,(function(t,e){return e(t.tr.replaceSelectionWith(j.nodes.hard_break.create()).scrollIntoView()),!0}));function Ve(t,e){return Be(t,e,!1)}function Be(t,e,n){if(void 0===n&&(n=!1),!Ie(t.selection))return!1;if(e){var r=j.nodes.paragraph,o=n?t.selection.$head.before(-3)-1:t.selection.$head.after(-3)+1,i=t.tr;try{i.doc.resolve(o)}catch(t){var s=n?o+1:o-1;i.insert(s,r.create())}i.setSelection(a.Selection.near(i.doc.resolve(Math.max(0,o)),1)),e(i.scrollIntoView())}return!0}function Ne(t,e,n){if(!Ie(e.selection)||Ae(e.selection))return!1;if(n){var r=e.selection.$head,o=r.node(-1),i=[];o.forEach((function(t){i.push(j.nodes.table_cell.create(t.attrs))}));var a=j.nodes.table_row.create(null,i),s=t?r.before(-1):r.after(-1);n(e.tr.insert(s,a).scrollIntoView())}return!0}function ze(t,e,n){if(!Ie(e.selection))return!1;if(n){var r,o=e.selection.$head,i=o.node(-3),a=o.index(-1),s=[],l=o.start(-3);i.descendants((function(e,n){if(!I.includes(e.type))return!1;if(e.type===j.nodes.table_row&&(r=e.child(a)),r&&e==r){var o=t?i.resolve(n+1).before():i.resolve(n+1).after();s.push([e.type,l+o])}}));for(var c=e.tr,u=0,d=s.reverse();u<d.length;u++){var p=d[u];c=c.insert(p[1],p[0].create())}n(c.scrollIntoView())}return!0}function Fe(t,e){if(!Ie(t.selection)||Ae(t.selection))return!1;if(e){var n=t.tr,r=t.selection.$head;if(1===r.node(-2).childCount)return $e(t,e);n.delete(r.start(-1)-1,r.end(-1)+1),e(n.scrollIntoView())}return!0}function He(t,e){if(!Ie(t.selection))return!1;var n=t.selection,r=n.$from,o=n.$to;return r.start(-3)>=r.pos-3&&r.end(-3)<=o.pos+3?$e(t,e):r.start(-1)>=r.pos-1&&r.end(-1)<=o.pos+1?Fe(t,e):!r.sameParent(o)}function qe(t,e,n){if(-1!==n&&1!==n)return!1;if(!Ie(t.selection))return!1;for(var r=t.selection.$head,o=-1;o>-4;o--){var i=r.index(o),s=r.node(o);if(s&&s.maybeChild(i+n)){var l=-1===n?r.start()- -1*o*2:r.end()+-1*o*2;return e(t.tr.setSelection(a.Selection.near(t.tr.doc.resolve(l),1)).scrollIntoView()),!0}}return 1===n?Ve(t,e):function(t,e){return Be(t,e,!0)}(t,e)}function Re(t,e){return qe(t,e,1)}function $e(t,e){var n=t.selection.$head;return e&&e(t.tr.deleteRange(n.start(-3)-1,n.end(-3)+1)),!0}function Ue(t,e){if(!(0,r.uJ)(j.nodes.table)(t))return!1;if(!e)return!0;var n,o,i=1,a=1,s=function(){return j.nodes.table_cell.create(null,j.text("cell "+a++))},l=function(){return j.nodes.table_header.create(null,j.text("header "+i++))},c=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return j.nodes.table_row.create(null,t)},u=(n=function(t){return j.nodes.table_head.create(null,t)}(c(l(),l(),l())),o=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return j.nodes.table_body.create(null,t)}(c(s(),s(),s()),c(s(),s(),s()),c(s(),s(),s())),j.nodes.table.createChecked(null,[n,o])),d=t.tr.replaceSelectionWith(u);e(d.scrollIntoView());var p=t.apply(d),f=p.doc.nodeAt(p.tr.selection.to-1);return f&&f.type===j.nodes.text&&e((d=p.tr.insert(p.tr.selection.to,j.nodes.paragraph.create(null))).scrollIntoView()),!0}function We(t,e,n){return!(!W(n)||e&&(U(n),0))}function Ge(t,e,n){var o,i;if(t.selection.empty)return!1;if(e){var a=null!==(i=null===(o=t.selection.content().content.firstChild)||void 0===o?void 0:o.textContent)&&void 0!==i?i:null,s=/^http(s)?:\/\/\S+$/.exec(a),l=(null==s?void 0:s.length)>0?s[0]:"";if((0,r.w9)(j.marks.link,{href:l})(t,e)){var c=Le.setEditMode(!0,t,n.state.tr);n.dispatch(c)}}return!0}function Ke(t){return function(e){var n=e.selection,r=n.from,o=n.to,i=!1;return e.doc.nodesBetween(r,o,(function(e){return!(i=e.type.name===t.name)})),i}}function Ye(t){return function(e){var n=e.selection,r=n.from,o=n.$from,i=n.to;return n.empty?!!t.isInSet(e.storedMarks||o.marks()):e.doc.rangeHasMark(r,i,t)}}var Je=function(t){var e;return pt([{key:"toggleHeading",command:Pe(j.nodes.heading,{level:1}),dom:ft("Header","Heading","heading-btn"),active:Ke(j.nodes.heading)},{key:"toggleBold",command:(0,r.w9)(j.marks.strong),dom:ft("Bold","Bold","bold-btn"),active:Ye(j.marks.strong)},{key:"toggleEmphasis",command:(0,r.w9)(j.marks.em),dom:ft("Italic","Italic","italic-btn"),active:Ye(j.marks.em)},{key:"toggleCode",command:(0,r.w9)(j.marks.code),dom:ft("Code","Inline code","code-btn"),active:Ye(j.marks.code)},dt({key:"toggleStrike",command:(0,r.w9)(j.marks.strike),dom:ft("Strikethrough","Strikethrough","strike-btn"),active:Ye(j.marks.strike)},t.parserFeatures.extraEmphasis),ht(),{key:"toggleLink",command:Ge,dom:ft("Link","Link selection","insert-link-btn")},{key:"toggleBlockquote",command:Oe(j.nodes.blockquote),dom:ft("Quote","Blockquote","blockquote-btn"),active:Ke(j.nodes.blockquote)},{key:"toggleCodeblock",command:Pe(j.nodes.code_block),dom:ft("Codeblock","Code block","code-block-btn"),active:Ke(j.nodes.code_block)},dt({key:"insertImage",command:We,dom:ft("Image","Image","insert-image-btn")},!!(null===(e=t.imageUpload)||void 0===e?void 0:e.handler)),dt({key:"insertTable",command:Ue,dom:ft("Table","Table","insert-table-btn"),visible:function(t){return!Ie(t.selection)}},t.parserFeatures.tables),dt(Xe,t.parserFeatures.tables),ht(),{key:"toggleOrderedList",command:Oe(j.nodes.ordered_list),dom:ft("OrderedList","Numbered list","numbered-list-btn"),active:Ke(j.nodes.ordered_list)},{key:"toggleUnorderedList",command:Oe(j.nodes.bullet_list),dom:ft("UnorderedList","Bulleted list","bullet-list-btn"),active:Ke(j.nodes.bullet_list)},{key:"insertRule",command:je,dom:ft("HorizontalRule","Horizontal rule","horizontal-rule-btn")},ht((function(){return!1}),["sm:d-inline-block"]),{key:"undo",command:o.Yw,dom:ft("Undo","Undo","undo-btn",["sm:d-inline-block"]),visible:function(){return!1}},{key:"redo",command:o.KX,dom:ft("Refresh","Redo","redo-btn",["sm:d-inline-block"]),visible:function(){return!1}},ht(),vt("Help","Help",t.editorHelpLink)],t.menuParentContainer)},Xe=function(t,e,n,r){for(var o=[],i=4;i<arguments.length;i++)o[i-4]=arguments[i];var a="table-button-popover",s=ft(t,e,n);s.classList.add("s-btn","s-btn__dropdown"),s.setAttribute("aria-controls",a),s.setAttribute("data-controller","s-popover"),s.setAttribute("data-action","s-popover#toggle"),s.setAttribute("data-s-popover-toggle-class","is-selected"),s.dataset.key=n;var l=document.createElement("div");l.className="s-popover wmn-initial w-auto px0 pt0 pb8",l.id=a,l.setAttribute("role","menu");var c=document.createElement("div");c.className="s-popover--arrow",l.appendChild(c);var u=document.createElement("div");u.className="grid fd-column",u.append.apply(u,o.map((function(t){return t.dom}))),l.appendChild(u);var d=document.createElement("div");return d.appendChild(s),d.appendChild(l),{key:n,dom:d,children:o,command:function(){return!0},visible:r}}("Table","Edit table","table-dropdown",(function(t){return Ie(t.selection)}),gt("Column","columnSection"),mt("Remove column",(function(t,e){if(!Ie(t.selection))return!1;if(e){var n=t.selection.$head,r=n.node(-3);if(1===n.node(-1).childCount)return $e(t,e);var o,i=n.index(-1),a=[],s=n.start(-3);r.descendants((function(t,e){if(!I.includes(t.type))return!1;t.type===j.nodes.table_row&&(o=t.childCount>=i+1?t.child(i):null),o&&t==o&&a.push(r.resolve(e+1))}));for(var l=t.tr,c=0,u=a.reverse();c<u.length;c++){var d=u[c];l=l.delete(s+d.start()-1,s+d.end()+1)}e(l.scrollIntoView())}return!0}),"remove-column-btn"),mt("Insert column before",(function(t,e){return ze(!0,t,e)}),"insert-column-before-btn"),mt("Insert column after",(function(t,e){return ze(!1,t,e)}),"insert-column-after-btn"),gt("Row","rowSection"),mt("Remove row",Fe,"remove-row-btn"),mt("Insert row before",(function(t,e){return Ne(!0,t,e)}),"insert-row-before-btn"),mt("Insert row after",(function(t,e){return Ne(!1,t,e)}),"insert-row-after-btn")),Qe=n(896),Ze=(0,Qe.S0)(/^\s*>\s$/,j.nodes.blockquote),tn=(0,Qe.zK)(new RegExp("^(#{1,3})\\s$"),j.nodes.heading,(function(t){return{level:t[1].length}})),en=(0,Qe.zK)(/^```$/,j.nodes.code_block),nn=(0,Qe.S0)(/^\s*[*+-]\s$/,j.nodes.bullet_list),rn=(0,Qe.S0)(/^\s*\d\.\s$/,j.nodes.ordered_list,(function(t){return{order:+t[1]}}),(function(t,e){return e.childCount+e.attrs.order==+t[1]})),on=(0,Qe.Hw)({rules:[Ze,tn,en,nn,rn]}),an=n(4465),sn=(0,i.h)({"Mod-z":o.Yw,"Mod-y":o.KX,"Mod-Shift-z":o.KX,Backspace:Qe.dU,Enter:(0,an.s6)(j.nodes.list_item),Tab:(0,an.bw)(j.nodes.list_item),"Shift-Tab":(0,an.IB)(j.nodes.list_item),"Mod-Enter":De,"Shift-Enter":De,"Mod-b":(0,r.w9)(j.marks.strong),"Mod-i":(0,r.w9)(j.marks.em),"Mod-l":Ge,"Ctrl-q":(0,r.ym)(j.nodes.blockquote),"Mod-k":(0,r.w9)(j.marks.code),"Mod-g":We,"Ctrl-g":We,"Mod-o":(0,r.ym)(j.nodes.ordered_list),"Mod-u":(0,r.ym)(j.nodes.bullet_list),"Mod-h":(0,r.uJ)(j.nodes.heading),"Mod-r":je,"Mod-m":(0,r.uJ)(j.nodes.code_block)}),ln=(0,i.h)({"Mod-Enter":Ve,"Shift-Enter":Ve,Enter:Re,Backspace:He,Delete:He,"Mod-Backspace":He,"Mod-Delete":He,Tab:Re,"Shift-Tab":function(t,e){return qe(t,e,-1)}}),cn=function(){return(cn=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},un=cn(cn({},b.Dm.nodes),{blockquote:function(t,e){var n=e.attrs.markup||">";t.wrapBlock(n+" ",null,e,(function(){return t.renderContent(e)}))},code_block:function(t,e){var n=e.attrs.markup;n?(t.write(n+(e.attrs.params||"")+"\n"),t.text(e.textContent,!1),t.ensureNewLine(),t.write(n)):e.textContent.split("\n").forEach((function(e,n){n>0&&t.ensureNewLine(),t.text("    "+e,!1)})),t.closeBlock(e)},heading:function(t,e){var n=e.attrs.markup||"";n.startsWith("<")?(t.write("h1 tag TODO"),t.closeBlock(e)):n&&!n.startsWith("#")?(t.renderInline(e),t.ensureNewLine(),t.write(n),t.closeBlock(e)):(t.write(t.repeat("#",e.attrs.level)+" "),t.renderInline(e),t.closeBlock(e))},horizontal_rule:function(t,e){t.write(e.attrs.markup||"----------"),t.closeBlock(e)},bullet_list:function(t,e){var n=e.attrs.markup||"-";t.renderList(e,"  ",(function(){return n+" "}))},ordered_list:function(t,e){var n=e.attrs.order||1,r=String(n+e.childCount-1).length,o=t.repeat(" ",r+2),i=e.attrs.markup||".";t.renderList(e,o,(function(e){var o=String(n+e);return t.repeat(" ",r-o.length)+o+i+" "}))},list_item:function(t,e){t.renderContent(e)},paragraph:function(t,e){t.renderInline(e),t.closeBlock(e)},image:function(t,e){t.write("!["+t.esc(e.attrs.alt||"")+"]("+t.esc(e.attrs.src)+(e.attrs.title?" "+t.quote(e.attrs.title):"")+")")},hard_break:function(t,e,n,r){for(var o=r+1;o<n.childCount;o++)if(n.child(o).type!=e.type)return void t.write("  \n")},text:function(t,e){var n=t.atBlank()||t.closed,r=t.esc(e.text,n);r=r.replace(/\b_|_\b/g,"\\_"),t.text(r,!1)}}),dn={html_inline:function(t,e){t.write(e.attrs.content),t.ensureNewLine(),t.write("\n")},html_block:function(t,e){t.write(e.attrs.content),t.ensureNewLine(),t.write("\n")},html_block_container:function(t,e){t.write(e.attrs.contentOpen),t.ensureNewLine(),t.write("\n"),t.renderContent(e),t.write(e.attrs.contentClose),t.closeBlock(e)},softbreak:function(t){t.write("\n")},table:function(t,e){function n(e){var n=[];return e.forEach((function(e){if(e.type===j.nodes.table_header||e.type===j.nodes.table_cell){var r=function(e){return t.write("| "),t.renderInline(e),t.write(" "),function(t){var e=t.attrs.style;if(!e)return null;var n=e.match(/text-align:[ ]?(left|right|center)/);return n&&n[1]?n[1]:null}(e)}(e);n.push(r)}})),t.write("|"),t.ensureNewLine(),n}e.forEach((function(e){e.type===j.nodes.table_head&&function(e){var r=[];e.forEach((function(t){t.type===j.nodes.table_row&&(r=n(t))}));for(var o=0,i=r;o<i.length;o++){var a=i[o];t.write("|"),t.write("left"===a||"center"===a?":":" "),t.write("---"),t.write("right"===a||"center"===a?":":" ")}t.write("|"),t.ensureNewLine()}(e),e.type===j.nodes.table_body&&(e.forEach((function(t){t.type===j.nodes.table_row&&n(t)})),t.ensureNewLine())})),t.ensureNewLine(),t.write("\n")},tagLink:function(t,e){var n="meta-tag"===e.attrs.tagType?"meta-tag":"tag",r=e.attrs.tagName;t.write("["+n+":"+r+"]")},spoiler:function(t,e){t.wrapBlock(">! ",null,e,(function(){return t.renderContent(e)}))}};function pn(t){return t.open instanceof Function||t.close instanceof Function?(m("markdown-serializer genMarkupAwareMarkSpec","Unable to extend mark config with open/close as functions",t),t):cn(cn({},t),{open:function(e,n){return n.attrs.markup||t.open},close:function(e,n){var r=n.attrs.markup;return(r=/^<[a-z]+>$/i.test(r)?r.replace(/^</,"</"):r)||t.close}})}var fn=b.Dm.marks.link,hn={open:function(t,e,n,r){if(!e.attrs.markup)return"string"==typeof fn.open?fn.open:fn.open(t,e,n,r);if("linkify"===e.attrs.markup)return"";if("autolink"===e.attrs.markup)return"<";var o=e.attrs.title?' title="'+e.attrs.title+'"':"";return"<a"+(e.attrs.href?' href="'+e.attrs.href+'"':"")+o+">"},close:function(t,e,n,r){return e.attrs.markup?"linkify"===e.attrs.markup?"":"autolink"===e.attrs.markup?">":"</a>":"string"==typeof fn.close?fn.close:fn.close(t,e,n,r)}},mn=cn(cn({},b.Dm.marks),{em:pn(b.Dm.marks.em),strong:pn(b.Dm.marks.strong),link:hn,strike:pn({open:"~~",close:"~~",mixable:!0,expelEnclosingWhitespace:!0}),kbd:pn({open:"<kbd>",close:"</kbd>",mixable:!0,expelEnclosingWhitespace:!0}),sup:pn({open:"<sup>",close:"</sup>",mixable:!0,expelEnclosingWhitespace:!0}),sub:pn({open:"<sub>",close:"</sub>",mixable:!0,expelEnclosingWhitespace:!0})}),gn=function(){function t(t){this.language=null,this.dom=document.createElement("div"),this.dom.classList.add("ps-relative","p0","ws-normal","ow-normal");var e=this.getLanguageFromBlock(t);this.language=e,this.dom.innerHTML='\n<div class="ps-absolute t2 r4 fs-fine pe-none us-none fc-black-300 js-language-indicator" contenteditable=false>'+e+'</div>\n<pre class="s-code-block"><code class="content-dom"></code></pre>\n        ',this.contentDOM=this.dom.querySelector(".content-dom")}return t.prototype.update=function(t){var e=this.getLanguageFromBlock(t);return this.language!==e&&(this.dom.querySelector(".js-language-indicator").textContent=e,this.language=e),!0},t.prototype.getLanguageFromBlock=function(t){var e=t.attrs.detectedHighlightLanguage;return e&&(e+=" (auto)"),e||u(t)},t}(),vn=function(t){this.dom=document.createElement("div"),this.dom.className="html_block ProseMirror-widget",this.dom.innerHTML=t.attrs.content},bn=function(t){if(this.dom=document.createElement("div"),this.dom.className="html_block_container ProseMirror-widget",t.childCount){var e=t.attrs.contentOpen+'<div class="ProseMirror-contentdom"></div>'+t.attrs.contentClose;this.dom.innerHTML=e,this.contentDOM=this.dom.querySelector(".ProseMirror-contentdom")}else this.dom.innerHTML="invalid html_block_container"},kn=0,yn=function(){function t(t,e,n){var r=this;this.id=kn++,this.img=this.createImage(t),this.form=this.createForm(),this.form.addEventListener("submit",(function(t){return r.handleChangedImageAttributes(t,n,e)})),this.popover=this.createPopover(),this.dom=document.createElement("div"),this.dom.appendChild(this.img),this.dom.appendChild(this.popover),this.dom.addEventListener("s-popover:hide",(function(t){return r.preventClose(t)}))}return t.prototype.selectNode=function(){this.img.classList.add("bs-ring"),this.selectionActive=!0,this.img.dispatchEvent(new Event("image-popover-show"));var t=this.form.querySelectorAll("input");t.length>0&&t[0].focus({preventScroll:!0})},t.prototype.deselectNode=function(){this.img.classList.remove("bs-ring"),this.selectionActive=!1,this.img.dispatchEvent(new Event("image-popover-hide"))},t.prototype.stopEvent=function(t){return this.popover.contains(t.target)},t.prototype.ignoreMutation=function(){return!0},t.prototype.destroy=function(){this.img.remove(),this.popover.remove(),this.dom=null,this.form.remove()},t.prototype.createImage=function(t){var e=document.createElement("img");return e.setAttribute("aria-controls","img-popover-"+this.id),e.setAttribute("data-controller","s-popover"),e.setAttribute("data-action","image-popover-show->s-popover#show image-popover-hide->s-popover#hide"),e.src=t.attrs.src,t.attrs.alt&&(e.alt=t.attrs.alt),t.attrs.title&&(e.title=t.attrs.title),e},t.prototype.createForm=function(){var t=document.createElement("form");return t.className="grid fd-column",t.innerHTML='\n            <label class="grid--cell s-label mb4" for="img-src-'+this.id+'">Image source</label>\n            <div class="grid ps-relative mb12">\n                <input class="grid--cell s-input" type="text" name="src" id="img-src-'+this.id+'" value="'+this.img.src+'" placeholder="https://example.com/image.png"/>\n            </div>\n            <label class="grid--cell s-label mb4" for="img-alt-'+this.id+'">Image description</label>\n            <div class="grid ps-relative mb12">\n                <input class="grid--cell s-input" type="text" name="alt" id="img-alt-'+this.id+'" value="'+this.img.alt+'" placeholder="A description for the image"/>\n            </div>\n            <label class="grid--cell s-label mb4" for="img-title-'+this.id+'">Title</label>\n            <div class="grid ps-relative mb12">\n                <input class="grid--cell s-input" type="text" name="title" id="img-title-'+this.id+'" value="'+this.img.title+'" placeholder="A title shown on hover"/>\n            </div>\n\n            <button class="s-btn s-btn__primary" type="submit" aria-pressed="false">Apply</button>\n        ',t},t.prototype.createPopover=function(){var t=document.createElement("div");return t.className="s-popover ws-normal wb-normal js-img-popover",t.id="img-popover-"+this.id,t.innerHTML='<div class="s-popover--arrow ws-normal"></div>',t.append(this.form),t},t.prototype.handleChangedImageAttributes=function(t,e,n){var r=this;if(t.preventDefault(),"function"==typeof e){var o=function(t){return r.form.querySelector(t)},i=o("#img-src-"+this.id),a=o("#img-alt-"+this.id),s=o("#img-title-"+this.id);n.dispatch(n.state.tr.setNodeMarkup(e(),null,{src:i.value,alt:a.value,title:s.value})),n.focus()}},t.prototype.preventClose=function(t){this.selectionActive&&t.preventDefault()},t}(),wn=function(t,e){var n=this;if(this.dom=document.createElement("a"),this.dom.setAttribute("href","#"),this.dom.setAttribute("rel","tag"),this.dom.classList.add("s-tag"),this.dom.innerText=t.attrs.tagName,null==e?void 0:e.renderer){var r=e.renderer(t.attrs.tagName,"meta-tag"===t.attrs.tagType);if(!r||!(null==r?void 0:r.link))return void m("TagLink NodeView","Unable to render taglink due to invalid response from options.renderer: ",r);(r.additionalClasses||[]).forEach((function(t){return n.dom.classList.add(t)})),this.dom.setAttribute("href",r.link),this.dom.setAttribute("title",r.linkTitle)}},_n=new a.Plugin({props:{handlePaste:function(t,e,n){var r;if(!(r=1===n.content.childCount&&"code_block"===n.content.child(0).type.name?n.content.child(0).textContent:function(t){var e=t.getData("text/html");if(e&&e.includes("<code>")){var n=(new DOMParser).parseFromString(e,"text/html"),r=n.querySelector("code");return n.body.textContent.trim()!==r.textContent?null:r.textContent}var o=t.getData("text/plain");return o&&(t.getData("vscode-editor-data")||/^([ ]{2,}|\t)/m.test(o))?o:null}(e.clipboardData)))return!1;if("code_block"===t.state.selection.$from.node().type.name)t.dispatch(t.state.tr.insertText(r));else{var o=t.state.schema,i=o.node("code_block",{},o.text(r));t.dispatch(t.state.tr.replaceSelectionWith(i))}return!0}}}),Cn={};function Sn(t,e){var n=[];return t.descendants((function(t,r){var o=function(t,e){var n,r;if(!function(t){var e=t.content.firstChild;if(!e)return!1;var n=1===t.childCount,r="text"===e.type.name,o=e.marks.some((function(t){return"link"===t.type.name}));return n&&r&&o}(e))return null;var o=null===(r=null===(n=e.content.firstChild.marks.find((function(t){return"link"===t.type.name})))||void 0===n?void 0:n.attrs)||void 0===r?void 0:r.href;if(!o)return null;for(var i=0,a=t;i<a.length;i++){var s=a[i];if(s.domainTest&&s.domainTest.test(o))return{url:o,provider:s}}return null}(e,t);if(o)return n.push({provider:o,pos:r,node:t}),!1})),n}function xn(t,e){var n=[];return Sn(t,e).forEach((function(t){var e=function(){var t=document.createElement("div");return t.className="js-placeholder",t.innerHTML='<div class="s-spinner s-spinner__xs"></div>',t}();n.push(s.Decoration.widget(t.pos,e)),t.provider.url in Cn&&function(t,e){t.innerHTML="",e&&t.appendChild(e)}(e,Cn[t.provider.url])})),s.DecorationSet.create(t,n)}var En=new z("linkPreviews");var Ln=function(){return(Ln=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function Mn(t,e,n,r){var o=e.selection,i=o.from,a=o.to;return e.doc.nodesBetween(i,a,(function(e,o){if("spoiler"===e.type.name){var i=Ln({},e.attrs);i.revealed=n;var a=!1;return(null==r?void 0:r.length)&&r.forEach((function(t){var e=t.mapping.mapResult(o);if(e.deleted)return a=!0,!1;o=e.pos})),a||(t=t.setNodeMarkup(o,null,i)),!1}})),t}var On=new a.Plugin({appendTransaction:function(t,e,n){if(!rt(e,n))return null;var r=n.tr;return r=Mn(r,e,!1,t),(r=Mn(r,n,!0)).steps.length?r=r.setMeta("addToHistory",!1):null}}),Tn=new a.Plugin({key:new a.PluginKey("tablesPlugin"),props:{transformPasted:function(t){return new k.p2(Pn(t.content),1,1)},handlePaste:function(t,e,n){return!!Ie(t.state.selection)&&(t.dispatch(t.state.tr.insertText(function(t){return t.size&&t.content&&t.content.firstChild?t.content.firstChild.textContent:null}(n))),!0)}}});function Pn(t){var e=[];return t.forEach((function(t){t.type===j.nodes.table?e.push(j.nodes.paragraph.createAndFill({},j.text(t.textContent))):e.push(t.copy(Pn(t.content)))})),k.HY.fromArray(e)}var jn,In=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),An=function(){return(An=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},Dn=function(t,e){for(var n=0,r=e.length,o=t.length;n<r;n++,o++)t[o]=e[n];return t},Vn=function(t){function e(n,l,c){void 0===c&&(c={});var u,p=t.call(this)||this;p.options=tt(e.defaultOptions,c),p.externalPlugins=(p.options.externalPlugins||[]).reduce((function(t,e){return t?tt(t,e):e}),null)||{menuEntries:[],nodeViews:{},markdownParser:{tokens:{},plugins:[]},markdownSerializers:{},plugins:[],schema:null},p.markdownSerializer=(u=p.externalPlugins,new b.nZ(cn(cn(cn({},un),dn),u.markdownSerializers),mn));var f,m,g,v=p.parseContent(l),k=p.options.parserFeatures.tagLinks;return p.editorView=new s.EditorView((function(t){var e;(e=t.classList).add.apply(e,p.options.classList),n.appendChild(t)}),{editable:J,state:a.EditorState.create({doc:v,plugins:Dn([(0,o.m8)(),ln,sn,(0,i.h)(r.YR),Je(p.options),on,(g=p.options.linkPreviewProviders,g=g||[],new H({key:En,asyncCallback:function(t){return function(t,e){var n=Sn(t.state.doc,e).filter((function(t){return!(t.provider.url in Cn)}));if(!n.length)return Promise.reject(null);var r=n.map((function(t){return t.provider.provider.renderer(t.provider.url).then((function(e){return Cn[t.provider.url]=e,e})).catch((function(){var e=document.createElement("div");return e.innerText="Error fetching content.",Cn[t.provider.url]=e,Promise.resolve(e)}))}));return Promise.all(r)}(t,g)},state:{init:function(t,e){return xn(e.doc,g)},apply:function(t,e){return this.getCallbackData(t)?xn(t.doc,g):e.map(t.mapping,t.doc)}},props:{decorations:function(t){return this.getState(t)}}})),d(p.options.codeblockOverrideLanguage),Me,(f=p.options.imageUpload,m=p.options.pluginParentContainer,G(f,m,(function(t,e,n){var r=f.wrapImagesInLinks?[j.marks.link.create({href:e})]:null,o=j.nodes.image.create({src:e},null,r);return t.tr.replaceWith(n,n,o)}))),Q(),On,Tn,_n],p.externalPlugins.plugins)}),nodeViews:An({code_block:function(t){return new gn(t)},image:function(t,e,n){return new yn(t,e,n)},tagLink:function(t){return new wn(t,k)},html_block:function(t){return new vn(t)},html_block_container:function(t){return new bn(t)}},p.externalPlugins.nodeViews)}),h("prosemirror rich-text document",p.editorView.state.doc.toJSON().content),p}return In(e,t),Object.defineProperty(e,"defaultOptions",{get:function(){return{parserFeatures:st,editorHelpLink:null,linkPreviewProviders:[],codeblockOverrideLanguage:null,menuParentContainer:null,imageUpload:{handler:q},externalPlugins:[]}},enumerable:!1,configurable:!0}),e.prototype.parseContent=function(t){var e,n,r,o,i=(n=j,(r=null===(e=this.externalPlugins)||void 0===e?void 0:e.schema)?(Object.keys(r.nodes).forEach((function(t){if(!n.nodes[t]){var e=new k.Jq(t,n,r.nodes[t]);Ut(e,n),n.nodes[t]=e}})),Object.keys(n.nodes).forEach((function(t){Ut(n.nodes[t],n)})),n):n),a=function(t,e,n){var r;if(!t)throw"Cannot build markdown parser without passed features.";var o=new Se("default",{html:t.html,linkify:!0});return t.tables||o.disable("table"),t.extraEmphasis||o.disable("strikethrough"),o.linkify.set({fuzzyLink:!1}),o.validateLink=at,t.html&&o.use((function(t){return se(t)})),o.use(ge),t.tagLinks&&o.use(ve,t.tagLinks),o.use(de),o.use(ke),(null==n?void 0:n.markdownParser)&&n.markdownParser.plugins.forEach((function(t){o.use(t)})),new Ce(e,o,we(we({},_e),null===(r=null==n?void 0:n.markdownParser)||void 0===r?void 0:r.tokens))}(this.options.parserFeatures,i,this.externalPlugins);try{o=a.parse(t)}catch(e){m("RichTextEditorConstructor markdownParser.parse","Catastrophic parse error!",e),o=D.fromSchema(i).parseCode(t),o=new $t.wx(o).insert(0,i.node("heading",{level:1},i.text("WARNING! There was an error parsing the document"))).doc}return o},e.prototype.serializeContent=function(){return this.markdownSerializer.serialize(this.editorView.state.doc)},e}(lt);!function(t){t[t.RichText=0]="RichText",t[t.Commonmark=1]="Commonmark"}(jn||(jn={}));var Bn=function(){function t(e,n,r){void 0===r&&(r={}),this.options=tt(t.defaultOptions,r),this.target=e,this.internalId=(1e4*Math.random()).toFixed(0),this.innerTarget=document.createElement("div"),this.target.appendChild(this.innerTarget),this.setupPluginContainer(),this.setBackingView(this.options.defaultView,n)}return Object.defineProperty(t.prototype,"editorView",{get:function(){var t;return null===(t=this.backingView)||void 0===t?void 0:t.editorView},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"content",{get:function(){var t;return(null===(t=this.backingView)||void 0===t?void 0:t.content)||""},set:function(t){this.backingView.content=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"document",{get:function(){return this.editorView.state.doc},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dom",{get:function(){return this.editorView.dom},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"readonly",{get:function(){return!!this.editorView&&!this.editorView.editable},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentViewType",{get:function(){return this.backingView instanceof Vn?jn.RichText:jn.Commonmark},enumerable:!1,configurable:!0}),Object.defineProperty(t,"defaultOptions",{get:function(){var t=["fl1","outline-none","p12","pt6","w100","s-prose","js-editor","ProseMirror"];return{defaultView:jn.RichText,targetClassList:["ps-relative","z-base","s-textarea","overflow-auto","hmn2","w100","p0","s-editor-resizable"],parserFeatures:Vn.defaultOptions.parserFeatures,commonmarkOptions:{classList:t},richTextOptions:{classList:t}}},enumerable:!1,configurable:!0}),t.prototype.focus=function(){this.backingView.focus()},t.prototype.destroy=function(){this.backingView.destroy()},t.prototype.setView=function(t){this.setBackingView(t,null)},t.prototype.enable=function(){var e;X(!1,this.editorView.state,this.editorView.dispatch.bind(null)),(e=this.innerTarget.classList).remove.apply(e,t.READONLY_CLASSES)},t.prototype.disable=function(){var e;X(!0,this.editorView.state,this.editorView.dispatch.bind(null)),(e=this.innerTarget.classList).add.apply(e,t.READONLY_CLASSES)},t.prototype.reinitialize=function(t){void 0===t&&(t={}),this.options=tt(this.options,t),this.setBackingView(this.currentViewType,this.content)},t.prototype.setupPluginContainer=function(){this.pluginContainer=document.createElement("div"),this.pluginContainer.className="py6 bg-inherit btr-sm w100 ps-sticky t0 l0 z-nav s-editor-shadow js-plugin-container js-sticky";var t=document.createElement("div");t.className="grid overflow-x-auto ai-center px12 py4 pb0",this.pluginContainer.appendChild(t),this.options.menuParentContainer=function(){return t};var e,n,r=document.createElement("div");this.pluginContainer.appendChild(r),this.options.pluginParentContainer=function(){return r},this.innerTarget.appendChild(this.pluginContainer),this.createEditorSwitcher(this.options.defaultView,t),this.pluginContainer.addEventListener("mousedown",(function(t){t.preventDefault()})),e=this.innerTarget,n=new IntersectionObserver((function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e],o=!r.isIntersecting,i=r.target.nextElementSibling,a=new CustomEvent("sticky-change",{detail:{stuck:o,target:i}});document.dispatchEvent(a)}}),{threshold:[0],root:e}),e.querySelectorAll(".js-sticky").forEach((function(t){var e=document.createElement("div");e.className="js-sticky-sentinel",t.parentNode.insertBefore(e,t),n.observe(e)})),document.addEventListener("sticky-change",(function(t){var e=t.detail.target;e.classList.contains("js-plugin-container")&&e.classList.toggle("is-stuck",t.detail.stuck)}))},t.prototype.setBackingView=function(t,e){var n,r=this,o=this.readonly;if(this.backingView&&(e=e||this.backingView.content,this.backingView.destroy()),(n=this.innerTarget.classList).add.apply(n,this.options.targetClassList),t===jn.RichText)this.backingView=new Vn(this.innerTarget,e,tt(this.options,this.options.richTextOptions));else{if(t!==jn.Commonmark)throw"Unable to set editor to unknown type: "+jn[t];this.backingView=new Rt(this.innerTarget,e,tt(this.options,this.options.commonmarkOptions))}this.backingView.editorView.props.handleDOMEvents={focus:function(){return r.innerTarget.classList.add("bs-ring","bc-blue-300"),!1},blur:function(){return r.innerTarget.classList.remove("bs-ring","bc-blue-300"),!1}},o?this.disable():this.enable()},t.prototype.createEditorSwitcher=function(t,e){var n=t===jn.Commonmark?"checked":"",r='<label class="grid--cell fs-caption mr4 sm:d-none" for="js-editor-toggle-'+this.internalId+'">Markdown</label>\n<label class="grid--cell mr4 d-none sm:d-block" for="js-editor-toggle-'+this.internalId+'">\n    <span class="icon-bg iconMarkdown"></span>\n</label>\n<div class="grid--cell s-toggle-switch js-editor-mode-switcher">\n    <input class="js-editor-toggle-state" id="js-editor-toggle-'+this.internalId+'" type="checkbox" '+n+'/>\n    <div class="s-toggle-switch--indicator"></div>\n</div>',o=document.createElement("div");o.className="grid--cell grid ai-center ml24 fc-medium",o.innerHTML=r,o.title="Toggle Markdown editing",o.querySelector("#js-editor-toggle-"+this.internalId).addEventListener("change",this.editorSwitcherChangeHandler.bind(this)),e.appendChild(o)},t.prototype.prefixEventName=function(t){return"StacksEditor:"+t},t.prototype.editorSwitcherChangeHandler=function(t){t.stopPropagation(),t.preventDefault();var e=this.currentViewType===jn.Commonmark?jn.RichText:jn.Commonmark;this.setView(e),this.target.querySelector("#js-editor-toggle-"+this.internalId).checked=e===jn.Commonmark;var n=new CustomEvent(this.prefixEventName("view-change"),{detail:{editorType:e}});this.target.dispatchEvent(n),this.focus()},t.READONLY_CLASSES=["s-input__readonly"],t}()}}]);